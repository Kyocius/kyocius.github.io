[{"content":"å‰è¨€ å°±æ˜¯å¤ªä¹…æ²¡å†™å¼‚æ­¥ï¼Œæœ‰çš„ç”¨æ³•å¿˜äº†ã€‚æ‰€ä»¥å†™ç¯‡åšå®¢å›é¡¾ä¸€ä¸‹ã€‚\nå¤§é‡å‚è€ƒã€ŠC# 10 in a Nutshellã€‹\nçº¿ç¨‹ Thread è™½ç„¶åœ¨ C# ä¸­ Task çš„ä½¿ç”¨é¢‘ç‡è¿œè¶…ç›´æ¥ä½¿ç”¨çº¿ç¨‹ï¼Œä½†æ˜¯æœ‰å…³çº¿ç¨‹çš„æ¦‚å¿µè¿˜æ˜¯è¦å¤ä¹ ä¸€ä¸‹çš„ã€‚\næ‰ä¸æ˜¯å› ä¸ºæˆ‘å…¨å¿˜äº†\nåˆ›å»ºçº¿ç¨‹ Create a Thread 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 using System; using System.Threading; var t = new Thread(WriteY); t.Start(); for (var i = 0; i \u0026lt; 1000; i++) { Console.Write(\u0026#34;x\u0026#34;); } void WriteY() { for (var i = 0; i \u0026lt; 1000; i++) Console.Write(\u0026#34;y\u0026#34;); } //è¾“å‡ºï¼š xxxxxxxxxxxxxyyyyyyyyyyyyyyyyyyyyy... xxxxxxxxxxxxxxxxxxxxxxxxxyyyyyyyyy... xxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyyyy... yyyyyyyyyxxxxxxxxxxxxxxxxxxxxxxxxx... æˆ‘ä»¬å¯ä»¥é€šè¿‡ Name å±æ€§æ¥è®¿é—®çº¿ç¨‹çš„åå­—ï¼š\n1 WriteLine(Thread.CurrentThread.Name); Join ä¸ Sleep ä½ å¯ä»¥ä½¿ç”¨ Join æ–¹æ³•æ¥ç­‰å¾…çº¿ç¨‹ç»“æŸï¼š\n1 2 3 4 5 6 Thread t = new Thread(Go); t.Start(); t.Join(); Console.WriteLine(\u0026#34;çº¿ç¨‹tç»“æŸ\u0026#34;); void Go() { for (var i = 0; i \u0026lt; 1000; i++) Console.Write(\u0026#34;y\u0026#34;); } è¿™æ®µä»£ç ä¼šæ‰“å° y 1000 æ¬¡ç„¶åæ‰ä¼šè¾“å‡º çº¿ç¨‹tç»“æŸã€‚\nä¸‹é¢æ˜¯ Sleep çš„ç”¨æ³•ï¼š\n1 2 Thread.Sleep(TimeSpan.FromHours(1)); //ç¡ä¸€å°æ—¶ Thread.Sleep(500) //ç¡500æ¯«ç§’ ç‰¹æ®Šçš„æ˜¯ï¼š\nThread.Sleep(0) å¯ä»¥æ”¾å¼ƒå½“å‰çº¿ç¨‹ï¼Œä¸»åŠ¨å°† CPU ç§»äº¤ç»™å…¶å®ƒçº¿ç¨‹ã€‚\nThread.Yield() æ–¹æ³•ä½œç”¨ç±»ä¼¼ï¼Œåªæ˜¯ç§»äº¤ç›¸åŒçš„å¤„ç†å™¨ã€‚\né˜»å¡çº¿ç¨‹ Blocking æŸ¥è¯¢é˜»å¡çŠ¶æ€ï¼š\n1 bool isBlocked = (someThread.ThreadState \u0026amp; ThreadState.WaitSleepJoin) != 0; ThreadState æ˜¯ä¸€ä¸ª flags æšä¸¾ã€‚\nI/O å¯†é›†å‹ \u0026amp; è®¡ç®—å¯†é›†å‹ Bound ä¸¤è€…æ˜¯ C# å¹¶å‘ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µã€‚\nç­‰å¾…äº‹ä»¶å‘ç”Ÿçš„æ“ä½œå«ä½œ I/O å¯†é›†å‹ï¼ˆI/O-boundï¼‰ å ç”¨ CPU æ¥å¤„ç†æ•°æ®å«è®¡ç®—å¯†é›†å‹ï¼ˆCompute-boundï¼‰ å±€éƒ¨å˜é‡ \u0026amp; å…±äº«çŠ¶æ€ Local \u0026amp; Shared State CLR ä¼šåˆ†é…ç»™æ¯ä¸ªçº¿ç¨‹ä¸åŒçš„å†…å­˜æ ˆï¼Œæ‰€ä»¥æŸä¸€çº¿ç¨‹çš„å±€éƒ¨å˜é‡æ˜¯ä¸å…¶å®ƒçº¿ç¨‹éš”ç»çš„ï¼š\n1 2 3 4 5 6 7 new Thread (Go).Start(); // åœ¨æ–°çº¿ç¨‹è°ƒç”¨Goæ–¹æ³• Go(); // åœ¨ä¸»çº¿ç¨‹è°ƒç”¨Goæ–¹æ³• void Go() { //å±€éƒ¨å˜é‡cycles for (int cycles = 0; cycles \u0026lt; 5; cycles++) Console.Write (\u0026#39;?\u0026#39;); } ç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œä¼šè¾“å‡º 10 ä¸ªé—®å·ã€Œ?ã€ã€‚\nä½†æ˜¯çº¿ç¨‹å¯ä»¥å…±äº«æ•°æ®ï¼šå¦‚æœå®ƒä»¬æœ‰å¯¹åŒä¸€å¯¹è±¡æˆ–å˜é‡çš„å¼•ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 bool _done = false; new Thread (Go).Start(); Go() ; void Go() { if (!_done) { _done = true; Console.WriteLine (\u0026#34;Done\u0026#34;); } } ä¸¤ä¸ªçº¿ç¨‹å…±äº«äº† _done æ‰€ä»¥ã€ŒDoneã€ä»…ä»…è¾“å‡ºä¸€æ¬¡ã€‚\næ¢æˆ Lambda è¡¨è¾¾å¼ä¹Ÿæ˜¯å¯ä»¥å…±äº«çš„ï¼š\n1 2 3 4 5 6 7 bool done = false; ThreadStart action = () =\u0026gt; { if (!done) { done = true; Console.WriteLine (\u0026#34;Done\u0026#34;); } }; new Thread (action).Start(); action(); è¿™å¼•å‡ºäº†ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼šçº¿ç¨‹å®‰å…¨ï¼\nçº¿ç¨‹é” \u0026amp; çº¿ç¨‹å®‰å…¨ Lock \u0026amp; Thread Safety æ¥çœ‹çœ‹é”ğŸ”’ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 class ThreadSafe { static bool _done; static readonly object _locker = new object(); static void Main() { new Thread (Go).Start(); Go(); } static void Go() { lock (_locker) { if (!_done) { Console.WriteLine (\u0026#34;Done\u0026#34;); _done = true; } } } } å…¶å®è¿™ä¹Ÿä¸å¿…å¤šè¯´ï¼Œå°±æ˜¯é˜»æ­¢ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹æŸä¸€å˜é‡ç½¢äº†ã€‚\nå‘çº¿ç¨‹ä¼ é€’æ•°æ® æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åœ¨çº¿ç¨‹å¼€å§‹çš„æ—¶å€™ä¼ é€’æ•°æ®ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š\n1 2 3 4 Thread t = new Thread ( () =\u0026gt; Print (\u0026#34;Hello from t!\u0026#34;) ); t.Start(); void Print (string message) =\u0026gt; Console.WriteLine (message); ç”¨ Lambda è¡¨è¾¾å¼ä¹Ÿè¡Œï¼š\n1 2 3 4 5 new Thread (() =\u0026gt; { Console.WriteLine (\u0026#34;çœ‹ï¼æˆ‘è·‘åœ¨å¦ä¸€ä¸ªçº¿ç¨‹é‡Œï¼\u0026#34;); Console.WriteLine (\u0026#34;æœ‰æ‰‹å°±è¡Œï¼\u0026#34;); }).Start(); æ•è·å˜é‡ Captured Variables ä¸€å®šè¦å°å¿ƒæ•è·å˜é‡ï¼š\n1 2 for (int i = 0; i \u0026lt; 10; i++) new Thread (() =\u0026gt; Console.Write (i)).Start(); è¾“å‡ºç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼ç»“æœï¼š\n1 0223557799 é—®é¢˜æ‰€åœ¨æ˜¯å˜é‡ i æŒ‡å‘äº†å¾ªç¯ä¸­åŒä¸€å†…å­˜ä½ç½®ã€‚æ‰€ä»¥å˜é‡ i çš„å€¼å…¶å®ä¸€ç›´åœ¨è¢«ä¸åŒçº¿ç¨‹ä¿®æ”¹ã€‚\nè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼š\n1 2 3 4 5 for (int i = 0; i \u0026lt; 10; i++) { int temp = i; new Thread (() =\u0026gt; Console.Write (temp)).Start(); } å†æ¥çœ‹çœ‹ç±»ä¼¼çš„é—®é¢˜ï¼š\n1 2 3 4 5 6 7 string text = \u0026#34;t1\u0026#34;; Thread t1 = new Thread ( () =\u0026gt; Console.WriteLine (text) ); text = \u0026#34;t2\u0026#34;; Thread t2 = new Thread ( () =\u0026gt; Console.WriteLine (text) ); t1.Start(); t2.Start(); å› ä¸ºä¸¤ä¸ª Lambda è¡¨è¾¾å¼æ•è·äº†åŒä¸€å˜é‡ textï¼Œæ‰€ä»¥å€¼ t2 ä¼šè¢«è¾“å‡ºä¸¤æ¬¡ã€‚\nå¼‚å¸¸å¤„ç† å…ˆçœ‹çœ‹ä¸æ­£ç¡®çš„å†™æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 try { new Thread (Go).Start(); } catch (Exception ex) { // æ°¸è¿œä¸ä¼šåˆ°è¾¾è¿™é‡Œï¼ Console.WriteLine (\u0026#34;Exception!\u0026#34;); } void Go() { throw null; } // æœ¬åº”è¯¥æŠ›å‡ºNullå¼•ç”¨é”™è¯¯ æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨çº¿ç¨‹ä¹‹å¤–æ•è·å¼‚å¸¸æ˜¯æ²¡ç”¨çš„ã€‚\nè§£å†³æ–¹æ¡ˆæ˜¯æŠŠå¼‚å¸¸å¤„ç†è¯­å¥æ”¾å…¥æ–¹æ³•å†…ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 new Thread (Go).Start(); void Go() { try { throw null; } catch (Exception ex) { // è¿™æ ·å°±å¯ä»¥æ•è·äº† } } é›†ä¸­å¼‚å¸¸å¤„ç† Centralized Exception Handler åœ¨ WPFã€UWP æˆ–è€… WinForm åº”ç”¨é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è®¢é˜…å…¨å±€å¼‚å¸¸å¤„ç†äº‹ä»¶ Application.DispatcherUnhandledException ä»¥åŠ Application.ThreadExceptionã€‚\nå‰å°çº¿ç¨‹ \u0026amp; åå°çº¿ç¨‹ Foreground \u0026amp; Background Threads é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ æ˜¾å¼åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯å‰å°çº¿ç¨‹ã€‚ç¨‹åºç»“æŸï¼Œä½ çš„æ˜¾å¼çº¿ç¨‹ä¹Ÿä¼šç»“æŸã€‚\nåå°çº¿ç¨‹åˆ™ä¸ç„¶ï¼Œä¾ç„¶ä¼šä¿æŒè¿è¡Œã€‚\nä½ å¯ä»¥ç”¨ IsBackground å±æ€§æ¥æ“ä½œå‰åå°çŠ¶æ€ï¼š\n1 2 3 4 5 6 static void Main (string[] args) { Thread worker = new Thread ( () =\u0026gt; Console.ReadLine() ); if (args.Length \u0026gt; 0) worker.IsBackground = true; worker.Start(); } çº¿ç¨‹çº§åˆ« Thread Priority ä¸€ä¸ªçº¿ç¨‹çš„ Priority å±æ€§å†³å®šäº†å®ƒå¯ä»¥è¿è¡Œå¤šä¹…ï¼ˆç›¸è¾ƒäºå…¶å®ƒçº¿ç¨‹è€Œè¨€ï¼‰ï¼š\n1 enum ThreadPriority { Lowest, BelowNormal, Normal, AboveNormal, Highest } å‘ä¿¡å· Signaling æœ‰æ—¶ï¼Œä½ éœ€è¦çº¿ç¨‹ä¸€ç›´ç­‰å¾…ç›´åˆ°æ”¶åˆ°å…¶å®ƒçº¿ç¨‹å‘é€çš„é€šçŸ¥ï¼Œè¿™å°±æ˜¯ Signalingã€‚\næœ€ç®€å•çš„ Signaling ç»“æ„æ˜¯ ManualResetEvent ã€‚\nåœ¨ä¸€ä¸ª ManualResetEvent å—ä¸­è°ƒç”¨ WaitOne æ–¹æ³•ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°å¦ä¸€çº¿ç¨‹è°ƒç”¨ Set æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 var signal = new ManualResetEvent (false); new Thread (() =\u0026gt; { Console.WriteLine (\u0026#34;Waiting for signal...\u0026#34;); signal.WaitOne(); signal.Dispose(); Console.WriteLine (\u0026#34;Got signal!\u0026#34;); }).Start(); Thread.Sleep(2000); signal.Set(); // å‘é€ä¿¡å· çº¿ç¨‹åœ¨å®¢æˆ·ç«¯åº”ç”¨ Threading in Rich Client Applications åœ¨ WPF æˆ–è€… UWP ç­‰ç­‰å®¢æˆ·ç«¯çš„å¼€å‘ä¸­ï¼Œä½†æˆ‘ä»¬è¦æ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡æ—¶ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å¯åŠ¨ä¸€ä¸ªã€ŒWorkerã€çº¿ç¨‹ã€‚\nå½“ä½ æƒ³è¦ä»ã€ŒWorkerã€çº¿ç¨‹æ›´æ–° UI æ—¶ï¼Œä½ å¿…é¡»ä¼ é€’è‡³ UI çº¿ç¨‹ã€‚ç¼–ç¨‹æœ¯è¯­ã€Œç¼–åˆ— Marshalã€ä¸“é—¨æŒ‡ä»£è¿™ä¸€è¡Œä¸ºã€‚\nWPFï¼šè°ƒç”¨ Dispatcher å¯¹è±¡çš„ BeginInvoke æˆ– Invoke æ–¹æ³•\nUWPï¼šè°ƒç”¨ Dispatcher å¯¹è±¡çš„ RunAsync æˆ– Invoke æ–¹æ³•\nWinFormï¼šè°ƒç”¨æ§ä»¶çš„ BeginInvoke æˆ– Invoke æ–¹æ³•\nè¿™äº›æ–¹æ³•çš„å®è´¨éƒ½æ˜¯æŠŠä½ æƒ³è¦æ‰§è¡Œçš„æ–¹æ³•æ¨é€åˆ° UI çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚\nä½†æ˜¯ Invoke æ–¹æ³•æœ‰ä¸€ç‚¹ç‰¹æ®Šï¼šå®ƒä¼šé˜»å¡çº¿ç¨‹ç›´åˆ°æ¶ˆæ¯è¢« UI çº¿ç¨‹å¤„ç†ã€‚å› æ­¤å®ƒå¯ä»¥ç”¨æ¥è¿”å›å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 partial class MyWindow : Window { public MyWindow() { InitializeComponent(); new Thread (Work).Start(); } void Work() { Thread.Sleep (5000); // å‡è£…è€—æ—¶ä»»åŠ¡ UpdateMessage (\u0026#34;The answer\u0026#34;); } void UpdateMessage (string message) { Action action = () =\u0026gt; txtMessage.Text = message; Dispatcher.BeginInvoke (action); } } åŒæ­¥ä¸Šä¸‹æ–‡ Synchronization Contexts WPFã€UWP ç­‰ç­‰æ¡†æ¶éƒ½å®ç°äº†è¿™ä¸ªç±»ï¼ˆå­ç±»ï¼‰ã€‚\nè¿™ä¸ªç±»è¢«æ”¾åœ¨ System.ComponentModel ä¸­ï¼Œç”¨æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ ã€ŒMarshalã€æ“ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 partial class MyWindow : Window { SynchronizationContext _uiSyncContext; public MyWindow() { InitializeComponent(); // è·å–å½“å‰UIçº¿ç¨‹çš„åŒæ­¥ä¸Šä¸‹æ–‡ _uiSyncContext = SynchronizationContext.Current; new Thread (Work).Start(); } void Work() { Thread.Sleep (5000); // å‡è£…è€—æ—¶æ“ä½œ UpdateMessage (\u0026#34;The answer\u0026#34;); } void UpdateMessage (string message) { // Marshalå§”æ‰˜è‡³UIçº¿ç¨‹ _uiSyncContext.Post (_ =\u0026gt; txtMessage.Text = message, null); } } è°ƒç”¨ Post æ–¹æ³•ç­‰ä»·äºè°ƒç”¨ BeginInvoke æ–¹æ³•ã€‚\nçº¿ç¨‹æ±  The Thread Pool çº¿ç¨‹æ± å°±æ˜¯ç”¨æ¥æ–¹ä¾¿å¤šçº¿ç¨‹ç®¡ç†çš„ã€‚\næœ‰å‡ ç‚¹å€¼å¾—æ³¨æ„ï¼š\nä½ ä¸èƒ½ä¸ºæ± çº¿ç¨‹è®¾ç½® Name å±æ€§ï¼Œè¿™ä¼šè®© Debug æ›´åŠ å›°éš¾\næ± çº¿ç¨‹é€šå¸¸æ˜¯åå°çº¿ç¨‹\né˜»å¡æ± çº¿ç¨‹ä¼šå¯¼è‡´æ€§èƒ½é™ä½\nä½ å¯ä»¥æ”¹å˜æ± çº¿ç¨‹çš„çº§åˆ«ã€‚\nä½ å¯ä»¥é€šè¿‡ Thread.CurrentThread.IsThreadPoolThread. æ¥æŒ‡å®šæ˜¯å¦è®©çº¿ç¨‹åœ¨æ± é‡Œè¿è¡Œã€‚\nè¿›å…¥çº¿ç¨‹æ±  Enter the pool æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼š\n1 Task.Run (() =\u0026gt; Console.WriteLine (\u0026#34;ä½ å…ˆåˆ«æ€¥ï¼ŒTaskåé¢ä¼šè®²\u0026#34;)); åœ¨ .NET Framework 4.0 ä»¥å‰çš„ä¸Šå¤æ—¶æœŸ C# æ²¡æœ‰ Task åç¨‹ï¼Œæ˜¯è¿™æ ·è¿›å…¥çº¿ç¨‹æ± çš„ï¼š\n1 ThreadPool.QueueUserWorkItem (notUsed =\u0026gt; Console.WriteLine (\u0026#34;Hello\u0026#34;)); éšå¼ä½¿ç”¨çº¿ç¨‹æ± çš„åº“ï¼š\nASP.NET Core / Web API åº”ç”¨\nSystem.Timers.Timer å’Œ System.Threading.Timer\nBackgroundWorker ç±»ï¼ˆä¼ ç»Ÿï¼‰\nçº¿ç¨‹æ± å«ç”Ÿ Hygiene in the thread pool çº¿ç¨‹æ± è¿˜æœ‰ä¸€ä¸ªä½œç”¨æ˜¯ä¿è¯ CPU ä¸ä¼šã€Œè¶…é¢è®¤è´­ Oversubscriptionã€ã€‚\nã€ŒOversubscriptionã€æŒ‡çš„æ˜¯æ´»è·ƒçº¿ç¨‹æ•°é‡è¶…è¿‡ CPU æ ¸å¿ƒæ•°é‡çš„çŠ¶æ€ã€‚\næ€»ä¹‹ï¼ŒCLR ä¼šé€šè¿‡æ’åºä»»åŠ¡é˜Ÿåˆ—å’Œå‡é€Ÿä»»åŠ¡å¯åŠ¨æ¥é˜»æ­¢ã€Œè¶…é¢è®¤è´­ã€ã€‚\nä»»åŠ¡ Task åˆ›å»ºä»»åŠ¡ Create a Task 1 2 Task.Run (() =\u0026gt; Console.WriteLine (\u0026#34;Foo\u0026#34;)); Console.ReadLine(); //ç”¨æ¥é˜»å¡ä¸€ä¸‹ ç­‰å¾… Wait å’Œçº¿ç¨‹çš„ Join ç±»ä¼¼ï¼š\n1 2 3 4 5 6 7 8 Task task = Task.Run (() =\u0026gt; { Thread.Sleep (2000); Console.WriteLine (\u0026#34;Foo\u0026#34;); }); Console.WriteLine (task.IsCompleted); // False task.Wait(); // é˜»å¡ç›´åˆ°Taskç»“æŸ è€—æ—¶ä»»åŠ¡ LongRunning Task CLR é»˜è®¤ä¼šè®© Task è¿è¡Œåœ¨æ± çº¿ç¨‹ï¼ˆé€‚ç”¨äºçŸ­æ—¶è®¡ç®—çš„çº¿ç¨‹ï¼‰ã€‚\nä¸ºäº†è¿è¡Œè€—æ—¶é•¿çš„ Taskï¼š\n1 Task task = Task.Factory.StartNew (() =\u0026gt; ..., TaskCreationOptions.LongRunning); è¿”å›å€¼ Return Values æœ€ç®€å•çš„è¿”å›å€¼å†™æ³•ï¼š\n1 Task\u0026lt;int\u0026gt; task = Task.Run (() =\u0026gt; { Console.WriteLine (\u0026#34;Foo\u0026#34;); return 3; }); ä½ å¯ä»¥é€šè¿‡ Task çš„ Result å±æ€§æ¥è·å–è¿”å›å€¼ã€‚è¿™æ­¥æ“ä½œå°†ä¼šé˜»å¡çº¿ç¨‹ç›´è‡³ Task ç»“æŸï¼š\n1 2 int result = task.Result; Console.WriteLine(result); æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä½¿ç”¨ LINQ çš„ Taskï¼Œç”¨ä»¥è®¡ç®— 300 0000 ä»¥å†…çš„ç´ æ•°ï¼š\n1 2 3 4 5 6 Task\u0026lt;int\u0026gt; primeNumberTask = Task.Run (() =\u0026gt; Enumerable.Range (2, 3000000).Count (n =\u0026gt; Enumerable.Range (2, (int)Math.Sqrt(n)-1).All (i =\u0026gt; n % i \u0026gt; 0))); Console.WriteLine (\u0026#34;Task running...\u0026#34;); Console.WriteLine (\u0026#34;The answer is \u0026#34; + primeNumberTask.Result); å¼‚å¸¸ Exception 1 2 3 4 5 6 7 8 9 10 11 12 13 //å¼€å¯ä¸€ä¸ªæŠ›å‡ºNullReferenceExceptionçš„Task Task task = Task.Run (() =\u0026gt; { throw null; }); try { task.Wait(); } catch (AggregateException aex) { if (aex.InnerException is NullReferenceException) Console.WriteLine (\u0026#34;Null!\u0026#34;); else throw; } åç»­ Continuations é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½“ Task ç»“æŸä¹‹åè¯¥å¹²å•¥ï¼š\n1 2 3 4 5 6 7 8 9 10 Task\u0026lt;int\u0026gt; primeNumberTask = Task.Run (() =\u0026gt; Enumerable.Range (2, 3000000).Count (n =\u0026gt; Enumerable.Range (2, (int)Math.Sqrt(n)-1).All (i =\u0026gt; n % i \u0026gt; 0))); var awaiter = primeNumberTask.GetAwaiter(); awaiter.OnCompleted (() =\u0026gt; { int result = awaiter.GetResult(); Console.WriteLine (result); }); C# å¼‚æ­¥ç¼–ç¨‹ ç»ˆäºåˆ°äº†æœ¬ç« çš„é‡å¤´æˆäº†ï¼\nAwaiting await å…³é”®å­—è‡ªåŠ¨é™„åŠ åç»­æ“ä½œã€‚\nç®€å•ä½¿ç”¨ï¼š\n1 2 var result = await expression; statement(s); ç¼–è¯‘å™¨ä¼šæŠŠè¿™å°æ®µä»£ç è‡ªåŠ¨è½¬åŒ–ä¸ºï¼š\n1 2 3 4 5 6 var awaiter = expression.GetAwaiter(); awaiter.OnCompleted (() =\u0026gt; { var result = awaiter.GetResult(); statement(s); }); æ¥çœ‹çœ‹ä¹‹å‰çš„ä»£ç ï¼š\n1 2 3 4 5 6 Task\u0026lt;int\u0026gt; GetPrimesCountAsync (int start, int count) { return Task.Run (() =\u0026gt; ParallelEnumerable.Range (start, count).Count (n =\u0026gt; Enumerable.Range (2, (int)Math.Sqrt(n)-1).All (i =\u0026gt; n % i \u0026gt; 0))); } ä½¿ç”¨ await å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹è°ƒç”¨ï¼š\n1 2 int result = await GetPrimesCountAsync (2, 1000000); Console.WriteLine (result); ä½†åœ¨ç¼–è¯‘å‰ï¼Œæˆ‘ä»¬éœ€è¦ç»™å¤–å±‚ä»£ç åŠ ä¸€ä¸ª async å…³é”®å­—ï¼š\n1 2 3 4 5 async void DisplayPrimesCount() { int result = await GetPrimesCountAsync (2, 1000000); Console.WriteLine (result); } async å…³é”®å­—åªèƒ½åŠ ç»™è¿”å›å€¼ç±»å‹æ˜¯ voidï¼ŒTask ä»¥åŠ Task\u0026lt;TResult\u0026gt; çš„æ–¹æ³•ã€‚\nå½“è¿”å›å€¼æ˜¯ç©ºæ—¶ï¼š\n1 2 await Task.Delay (5000); Console.WriteLine (\u0026#34;Five seconds passed!\u0026#34;); æ•è·å±€éƒ¨å˜é‡ Capturing local state await çš„çœŸæ­£åŠ›é‡åœ¨äºå®ƒå¯ä»¥å‡ºç°åœ¨ä»£ç çš„ä»»æ„ä½ç½®ï¼ˆä½†ä¸èƒ½åœ¨çº¿ç¨‹é”ä»¥åŠ unsafe å—ä¸­ï¼‰ï¼š\n1 2 3 4 5 async void DisplayPrimeCounts() { for (int i = 0; i \u0026lt; 10; i++) Console.WriteLine (await GetPrimesCountAsync (i*1000000+2, 1000000)); } åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ GetPrimesCountAsync ä¹‹åï¼Œå˜é‡ i çš„å€¼ä¼šè¢«ä¿å­˜ã€‚\nåœ¨ UI ä¸­ç­‰å¾… Awaiting in a UI æˆ‘ä»¬å…ˆä»ä¸€ä¸ªåŒæ­¥çš„ä»£ç å¼€å§‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 class TestUI : Window { Button _button = new Button { Content = \u0026#34;Go\u0026#34; }; TextBlock _results = new TextBlock(); public TestUI() { var panel = new StackPanel(); panel.Children.Add (_button); panel.Children.Add (_results); Content = panel; _button.Click += (sender, args) =\u0026gt; Go(); } void Go() { for (int i = 1; i \u0026lt; 5; i++) _results.Text += GetPrimesCount (i * 1000000, 1000000) + \u0026#34; primes between \u0026#34; + (i*1000000) + \u0026#34; and \u0026#34; + ((i+1)*1000000-1) + Environment.NewLine; } int GetPrimesCount (int start, int count) { return ParallelEnumerable.Range (start, count).Count (n =\u0026gt; Enumerable.Range (2, (int) Math.Sqrt(n)-1).All (i =\u0026gt; n % i \u0026gt; 0)); } } å¯ä»¥çœ‹åˆ°ç‚¹å‡»æŒ‰é’®å°±ä¼šé˜»å¡çº¿ç¨‹ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨å¼‚æ­¥æ”¹å†™ã€‚\nç¬¬ä¸€æ­¥æ˜¯æŠŠè®¡ç®—ç´ æ•°çš„æ–¹æ³•æ”¹æˆå¼‚æ­¥çš„ï¼š\n1 2 3 4 Task\u0026lt;int\u0026gt; GetPrimesCountAsync (int start, int count) { return Task.Run (() =\u0026gt; ParallelEnumerable.Range (start, count).Count(n =\u0026gt; Enumerable.Range(2, (int) Math.Sqrt(n)-1).All (i =\u0026gt; n % i \u0026gt; 0))); } ç¬¬äºŒæ­¥æ˜¯ä¿®æ”¹ Go æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 async void Go() { _button.IsEnabled = false; for (int i = 1; i \u0026lt; 5; i++) _results.Text += await GetPrimesCountAsync (i * 1000000, 1000000) + \u0026#34; primes between \u0026#34; + (i*1000000) + \u0026#34; and \u0026#34; + ((i+1)*1000000-1) + Environment.NewLine; _button.IsEnabled = true; } å†æ¥å¦ä¸€ä¸ªä¾‹å­ï¼Œè¿™å›æˆ‘ä»¬æƒ³è¦ä»ç½‘ç»œä¸Šå¼‚æ­¥åœ°ä¸‹è½½æ•°æ®äº†ã€‚\né‡å†™ Go æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 async void Go() { _button.IsEnabled = false; string[] urls = \u0026#34;yoroion.github.io www.oreilly.com sinoahpx.github.io\u0026#34;.Split(); int totalLength = 0; try { foreach (string url in urls) { var uri = new Uri(\u0026#34;http://\u0026#34; + url) byte[] data = await new WebClient().DownloadDataTaskAsync (uri); _results.Text += \u0026#34;Length of \u0026#34; + url + \u0026#34; is \u0026#34; + data.Length + Environment.NewLine; totalLength += data.Length; } _results.Text += \u0026#34;Total length: \u0026#34; + totalLength; } catch { _results.Text += \u0026#34;Error: \u0026#34; + ex.Message; } finally { _button.IsEnabled = true; } } æˆ‘ä»¬é™„åŠ åœ¨ UI æ§ä»¶ä¸Šçš„ Event Handler åœ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmessage loopï¼‰ä¸­è¿›è¡Œã€‚\nå½“æˆ‘ä»¬çš„ Go æ–¹æ³•è¿è¡Œæ—¶ï¼Œç›´è‡³é‡åˆ° await è¡¨è¾¾å¼ï¼Œä¼šè·³è½¬å›æ¶ˆæ¯é˜Ÿåˆ—æ¥æ¥å“åº”å…¶å®ƒäº‹ä»¶ã€‚\nç¼–å†™å¼‚æ­¥æ–¹æ³• Writing Asynchronous Functions ç¼–å†™å¼‚æ­¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç©ºè¿”å›å€¼çš„æ–¹æ³•æ”¹æˆè¿”å› Taskï¼š\n1 2 3 4 5 6 async Task PrintAnswerToLife() //Task æ›¿ä»£äº† void { await Task.Delay (5000); int answer = 21 * 2; Console.WriteLine (answer); } å¯ä»¥å‘ç°æˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾å¼åœ°è¿”å› Taskï¼Œç¼–è¯‘å™¨å¸®æˆ‘ä»¬ç®€åŒ–äº†ï¼š\n1 2 3 4 5 async Task Go() { await PrintAnswerToLife(); Console.WriteLine(\u0026#34;Done\u0026#34;); } è¿”å› Task 1 2 3 4 5 6 async Task\u0026lt;int\u0026gt; GetAnswerToLife() { await Task.Delay (5000); int answer = 21 * 2; return answer; //ç›´æ¥è¿”å›æ•´å‹ } ","date":"2022-08-15T00:00:00Z","image":"https://yoroion.github.io/p/yoroion-csharp-tutorial-1/head_hu6445997bcd53608f7e2f035aad872a86_31881_120x120_fill_box_smart1_3.png","permalink":"https://yoroion.github.io/p/yoroion-csharp-tutorial-1/","title":"é§æ©çš„ C# ä¸å®Œå…¨æŒ‡å—  01 - å¹¶å‘ä¸å¼‚æ­¥"},{"content":"å‰è¨€ ä¹‹å‰æˆ‘ä»¬è§è¯†äº† Rx.NET çš„åŸºæœ¬ç”¨æ³•ï¼ŒæŠŠ .NET äº‹ä»¶è½¬åŒ–æˆäº†å¯è§‚å¯Ÿæ•°æ®æµï¼Œå¹¶ä¸”è¡¥å……äº†ä¸€äº›æ‹“å±•çŸ¥è¯†ï¼ˆExï¼‰ï¼Œç°åœ¨æˆ‘ä»¬è¦æ¥ç€æ·±å…¥ Rx.NET çš„æ ¸å¿ƒæŠ€æœ¯äº†ã€‚\næ™®é€šæ•°æ®æµ è¿˜è®°å¾—å—ï¼ŒIObservable æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• Subscribeï¼Œæ˜¯ Rx.NET çš„åŸºç¡€ã€‚\næˆ‘ä»¬å°†è¯•ç€æ‰“é€ ä¸€ä¸ªå³æ—¶é€šè®¯ç³»ç»Ÿã€‚\nå®ç° IObservable æ¥å£ åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œéå¸¸ä¸æ¨èç›´æ¥å®ç° IObservable æ¥å£ï¼Œä½†æ˜¯ç†è§£è¿™ä¸ªæµç¨‹å¯¹æˆ‘ä»¬çš„å­¦ä¹ å¾ˆæœ‰å¸®åŠ©ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 using System; using System.Reactive.Disposables; public class NumbersObservable : IObservable\u0026lt;int\u0026gt; { private readonly int _amount; public NumbersObservable(int amount) { _amount = amount; } public IDisposable Subscribe(IObserver\u0026lt;int\u0026gt; observer) { for (int i = 0; i \u0026lt; _amount; i++) { observer.OnNext(i); } observer.OnCompleted(); return Disposable.Empty; } } å®ç° Observer æ¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public class ConsoleObserver\u0026lt;T\u0026gt; : IObserver\u0026lt;T\u0026gt; { private readonly string _name; public ConsoleObserver(string name=\u0026#34;\u0026#34;) { _name = name; } public void OnNext(T value) { Console.WriteLine(\u0026#34;{0} - OnNext({1})\u0026#34;,_name,value); } public void OnError(Exception error) { Console.WriteLine(\u0026#34;{0} - OnError:\u0026#34;, _name); Console.WriteLine(\u0026#34;\\t {0}\u0026#34;, error); } public void OnCompleted() { Console.WriteLine(\u0026#34;{0} - OnCompleted()\u0026#34;, _name); } } æœ€åæ¶ˆè´¹å®ƒï¼š\n1 2 3 var numbers = new NumbersObservable(5); var subscription = numbers.Subscribe(new ConsoleObserver\u0026lt;int\u0026gt;(\u0026#34;numbers\u0026#34;)); çœ‹çœ‹ç»“æœï¼š\n1 2 3 4 5 6 numbers - OnNext(0) numbers - OnNext(1) numbers - OnNext(2) numbers - OnNext(3) numbers - OnNext(4) numbers - OnCompleted() æˆ‘ä»¬ç°åœ¨æ‰‹åŠ¨å®ç°äº†ä¸€ä¸ªå¯è§‚å¯Ÿæ•°æ®æµå’Œè§‚å¯Ÿè€…ã€‚\nå†æ¥ä¸ªæ‰©å±•æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬æ‰“å°ï¼Œ\næ³¨æ„ï¼è¿™ä¸ªæ–¹æ³•å°†ä¼šè´¯ç©¿ä¹‹åçš„ç« èŠ‚ï¼š\n1 2 3 4 5 6 7 public static class Extensions { public static IDisposable SubscribeConsole\u0026lt;T\u0026gt;( this IObservable\u0026lt;T\u0026gt; observable, string name = \u0026#34;\u0026#34;) { return observable.Subscribe(new ConsoleObserver\u0026lt;T\u0026gt;(name)); } } æ‰‹åŠ¨åˆ›å»º Observable çš„ç¼ºé™· æ‰‹åŠ¨åˆ›å»ºå¯è§‚å¯Ÿæ•°æ®æµä¸€èˆ¬ä¸æ¨èä¸”å¾ˆå°‘ç”¨ï¼Œå› ä¸ºå¦‚æ­¤æ˜æ˜¾ç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœä½ ä¸å°å¿ƒåœ¨ OnComplete æ–¹æ³•ä¹‹åè°ƒç”¨äº† OnNextï¼š\n1 2 3 4 5 6 7 8 9 10 11 public IDisposable Subscribe(IObserver\u0026lt;int\u0026gt; observer) { for (int i = 0; i \u0026lt; _amount; i++) { observer.OnNext(i); } observer.OnCompleted(); observer.OnNext(_amount); // æ³¨æ„è¿™è¡Œ return Disposable.Empty; } ä½ å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\n1 2 3 4 5 6 7 errorTest - OnNext(0) errorTest - OnNext(1) errorTest - OnNext(2) errorTest - OnNext(3) errorTest - OnNext(4) errorTest - OnComplete errorTest - OnNext(5) æ€ä¹ˆä¼šäº‹æï¼Œ OnComplete ä¹‹åå±…ç„¶è¿˜èƒ½è®¢é˜…åˆ°æ•°æ®ï¼Ÿ\nè¿™æ˜¯ Rx èƒŒå Observable ä¸ Observer çš„ Repeat æ–¹æ³•é‡æ–°è®¢é˜…å¯¼è‡´çš„ã€‚\nObservableBase æ¥å£ æ‰‹å†™ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œæ¯”å¦‚å½“ä½ æƒ³å°è£…ä¸€ä¸ªå¤æ‚çš„ã€åŒ…å«äº‹ä»¶å±æ€§çš„æ¥å£çš„æ—¶å€™ï¼š\n1 2 3 4 5 6 7 public interface IChatConnection { event Action\u0026lt;string\u0026gt; Received; event Action Closed; event Action\u0026lt;Exception\u0026gt; Error; void Disconnect(); } æˆ‘ä»¬ä¸€èˆ¬ä¼šå†™ä¸ª Clientï¼š\n1 2 3 4 5 6 7 8 public class ChatClient { ... public IChatConnection Connect(string user, string password) { // è¿æ¥æœåŠ¡ } } å†æ‰‹åŠ¨æ”¹å†™æˆä¸€ä¸ª Observableï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 using System; using System.Reactive; using System.Reactive.Disposables; public class ObservableConnection : ObservableBase\u0026lt;string\u0026gt; { private readonly IChatConnection _chatConnection; public ObservableConnection(IChatConnection chatConnection) { _chatConnection = chatConnection; } protected override IDisposable SubscribeCore(IObserver\u0026lt;string\u0026gt; observer) { Action\u0026lt;string\u0026gt; received = message =\u0026gt; { observer.OnNext(message); }; Action closed = () =\u0026gt; { observer.OnCompleted(); }; Action\u0026lt;Exception\u0026gt; error = ex =\u0026gt; { observer.OnError(ex); }; _chatConnection.Received += received; _chatConnection.Closed += closed; _chatConnection.Error += error; return Disposable.Create(() =\u0026gt; { _chatConnection.Received -= received; _chatConnection.Closed -= closed; _chatConnection.Error -= error; _chatConnection.Disconnect(); }); } } å‘ç°æ²¡ï¼Œè¿™å…¶å®å°±æ˜¯ SignalR çš„å†™æ³•ï¼ˆå¾®è½¯çš„åç«¯æ¡†æ¶ï¼‰\nç°åœ¨æ¶ˆè´¹ï¼š\n1 2 3 4 5 6 var chatClient = new ChatClient(); var connection = chatClient.Connect(\u0026#34;guest\u0026#34;, \u0026#34;guest\u0026#34;); IObservable\u0026lt;string\u0026gt; observableConnection = new ObservableConnection(connection); // æœ€å¼€å§‹çš„é‚£ä¸ªç±» var subscription = observableConnection.SubscribeConsole(\u0026#34;receiver\u0026#34;); å†™ä¸ªæ‰©å±•æ–¹æ³•æ¥ç®€åŒ–æ“ä½œï¼š\n1 2 3 4 5 6 7 public static class ChatExtensions { public static IObservable\u0026lt;string\u0026gt; ToObservable(this IChatConnection connection) { return new ObservableConnection(connection); } } ç»¼åˆä¸‹æ¥çœ‹ï¼Œè¿™ä¹ˆæ‰‹åŠ¨å†™ä¹Ÿå¤ªè¸é©¬æŠ˜ç£¨äº†ã€‚Rx æœ‰æ²¡æœ‰æ–¹æ³•æ¥ç®€åŒ–è¿™äº›æ“ä½œå‘¢ï¼Ÿ\nObservable.Create æ–¹æ³• åˆ«å‚»ä¹ä¹åœ°æ‰‹å†™äº†ï¼ŒRx å¯æ˜¯æä¾›äº†å¥½ç”¨çš„å·¥å‚å‡½æ•°å‘¢ã€‚\n1 2 3 4 5 6 7 8 9 Observable.Create\u0026lt;int\u0026gt;(observer =\u0026gt; { for (int i = 0; i \u0026lt; 5; i++) { observer.OnNext(i); } observer.OnCompleted(); return Disposable.Empty; }); ç›´æ¥å†™ä¸ª Lambda è¡¨è¾¾å¼æ¥ä½œä¸º Subscribe æ–¹æ³•ã€‚\nObservable.Create éå¸¸çµæ´»ï¼Œå› æ­¤ä¹Ÿè¢«å¤§é‡ä½¿ç”¨åœ¨ Rx çš„åº”ç”¨ä¸­ã€‚\nå»¶è¿Ÿåˆå§‹åŒ– Defer 1 2 3 4 5 public IObservable\u0026lt;string\u0026gt; ObserveMessages(string user, string password) { var connection = Connect(user, password); return connection.ToObservable(); } å½“æˆ‘ä»¬æƒ³è¦è¿™ä¸ªå¯è§‚å¯Ÿæ•°æ®æµä»…åœ¨æœ‰è§‚å¯Ÿè€…è®¢é˜…å®ƒçš„æ—¶å€™æ‰ä¼šè¢«åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Observable.Defer æ–¹æ³•æ¥å»¶è¿Ÿåˆå§‹åŒ–ï¼š\n1 2 3 4 5 6 7 8 public IObservable\u0026lt;string\u0026gt; ObserveMessagesDeferred(string user, string password) { return Observable.Defer(() =\u0026gt; { var connection = Connect(user, password); return connection.ToObservable(); }); } éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œç”±è¿™äº›å·¥å‚å‡½æ•°åˆ›å»ºçš„å¯è§‚å¯Ÿæ•°æ®æµå¹¶ä¸èƒ½å…±äº«è§‚å¯Ÿè€…ï¼š\n1 2 3 var messages = chatClient.ObserveMessagesDeferred(\u0026#34;user\u0026#34;,\u0026#34;password\u0026#34;); var subscription1 = messages.SubscribeConsole(); var subscription2 = messages.SubscribeConsole(); ä¹Ÿå°±æ˜¯è¯´ï¼Œ subscription1 å’Œ subscription2 æ˜¯ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„å®ä¾‹ã€‚\nå…³äºã€Œå…±äº«æµã€ã€Œçƒ­æµã€ä»¥åŠã€Œå†·æµã€çš„çŸ¥è¯†å°†ä¼šåœ¨ç¬¬å…­ç« è®²è§£ã€‚\nç”±äº‹ä»¶è½¬æ¢ åœ¨ç¬¬äºŒç« æˆ‘ä»¬å·²ç»è§è¯†è¿‡äº†ï¼Œè¿™å›æ¥ç‚¹å„¿æ›´æ·±å…¥çš„ã€‚\nå…ˆçœ‹å®šä¹‰ï¼š\n1 FromEventPattern\u0026lt;TDelegate, TEventArgs\u0026gt;(Action\u0026lt;TDelegate\u0026gt; addHandler, Action\u0026lt;TDelegate\u0026gt; removeHandler) æ ‡å‡†äº‹ä»¶ æ¥ä¸ªäº‹ä»¶ï¼š\n1 public event RoutedEventHandler Click; è¿™ä¸ªå§”æ‰˜ç±»å‹æ˜¯ System.Windows ä¸­å®šä¹‰å¥½çš„ï¼š\n1 public delegate void RoutedEventHandler(object sender, System.Windows.RoutedEventArgs e) è½¬åŒ–æˆå¯è§‚å¯Ÿçš„äº‹ä»¶æµï¼š\n1 2 3 4 5 IObservable\u0026lt;EventPattern\u0026lt;RoutedEventArgs\u0026gt;\u0026gt; clicks = Observable.FromEventPattern\u0026lt;RoutedEventHandler, RoutedEventArgs\u0026gt;( h =\u0026gt; theButton.Click += h, h =\u0026gt; theButton.Click -= h); clicks.SubscribeConsole(); Rx è¿˜æä¾›äº†ä¸€ç§ç®€åŒ–çš„å†™æ³•ï¼Œä½†å¹¶ä¸æ¨èï¼š\n1 2 IObservable\u0026lt;EventPattern\u0026lt;object\u0026gt;\u0026gt; clicks = Observable.FromEventPattern(theButton, \u0026#34;Click\u0026#34;); ä¸æ ‡å‡†äº‹ä»¶ å¹¶ä¸æ˜¯æ‰€æœ‰äº‹ä»¶çš„å‚æ•°éƒ½æ˜¯ä¸€ä¸ª Sender + ä¸€ä¸ª EventArgsã€‚\n1 2 3 4 5 6 7 public delegate void NetworkFoundEventHandler(string ssid); class WifiScanner { public event NetworkFoundEventHandler NetworkFound = delegate { }; // ... } å¯ä»¥çœ‹åˆ°è¿™ä¸ªäº‹ä»¶éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ã€‚\nä¹‹å‰çš„ FromEventPattern å°±ä¸èƒ½ç”¨äº†ï¼ŒRx æä¾›äº† FromEventï¼š\n1 IObservable\u0026lt;TEventArgs\u0026gt; FromEvent\u0026lt;TDelegate, TEventArgs\u0026gt;(Action\u0026lt;TDelegate\u0026gt; addHandler, Action\u0026lt;TDelegate\u0026gt; removeHandler); å¦‚æ­¤å°±å¯ä»¥ï¼š\n1 2 3 4 5 var wifiScanner = new WifiScanner(); IObservable\u0026lt;string\u0026gt; networks = Observable.FromEvent\u0026lt;NetworkFoundEventHandler, string\u0026gt;( h =\u0026gt; wifiScanner.NetworkFound += h, h =\u0026gt; wifiScanner.NetworkFound -= h); æ›´å¤æ‚çš„äº‹ä»¶ Of courseï¼Œè¿˜æœ‰æ›´å¤æ‚çš„äº‹ä»¶ï¼š\n1 2 3 4 5 6 public delegate void ExtendedNetworkFoundEventHandler(string ssid, int strength); class WifiScanner { public event ExtendedNetworkFoundEventHandler ExtendedNetworkFound = delegate { }; } æ”¾å¿ƒï¼ŒFromEvent æä¾›äº†é‡è½½ï¼š\n1 2 3 4 IObservable\u0026lt;TEventArgs\u0026gt; FromEvent\u0026lt;TDelegate, TEventArgs\u0026gt;( Func\u0026lt;Action\u0026lt;TEventArgs\u0026gt;, TDelegate\u0026gt; conversion, Action\u0026lt;TDelegate\u0026gt; addHandler, Action\u0026lt;TDelegate\u0026gt; removeHandler); ä¸‹é¢éœ€è¦åˆ©ç”¨å…ƒç»„ï¼ˆTupleï¼‰çš„ç‰¹æ€§ï¼š\n1 2 3 4 5 IObservable\u0026lt;Tuple\u0026lt;string, int\u0026gt;\u0026gt; networks = Observable.FromEvent\u0026lt;ExtendedNetworkFoundEventHandler, Tuple\u0026lt;string, int\u0026gt;\u0026gt;( rxHandler =\u0026gt; (ssid, strength) =\u0026gt; rxHandler(Tuple.Create(ssid, strength)), h =\u0026gt; wifiScanner.ExtendedNetworkFound += h, h =\u0026gt; wifiScanner.ExtendedNetworkFound -= h); æ— å‚äº‹ä»¶ 1 event Action Connected = delegate { }; æˆ‘ä»¬éœ€è¦è¿™ä¹ˆå†™ï¼š\n1 2 3 4 5 IObservable\u0026lt;Unit\u0026gt; connected = Observable.FromEvent(h =\u0026gt; wifiScanner.Connected += h, h =\u0026gt; wifiScanner.Connected -= h); connected.SubscribeConsole(\u0026#34;connected\u0026#34;); Unit ç±»å‹ä»£è¡¨äº†ã€Œç©ºã€ï¼Œå®ƒ ToString ä¹‹åçš„å€¼ä¸ºã€Œ()ã€\næ‰€ä»¥ä½ ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\n1 2 connected - OnNext(()) connected - OnNext(()) ç”±è¿­ä»£ç±»å‹è½¬æ¢ è¿­ä»£ç±»å‹å’Œå¯è§‚å¯Ÿç±»å‹é•¿å¾—å¾ˆåƒï¼ŒRx ä¹Ÿæä¾›äº†è½¬æ¢çš„æ–¹æ³•ã€‚\nè¿­ä»£ç±»å‹ â†’ å¯è§‚å¯Ÿæµ 1 2 3 4 IEnumerable\u0026lt;string\u0026gt; names = new []{\u0026#34;AHpx\u0026#34;, \u0026#34;Yoroion\u0026#34;, \u0026#34;Weeknic\u0026#34;, \u0026#34;GodLeaveMe\u0026#34;}; IObservable\u0026lt;string\u0026gt; observable = names.ToObservable(); observable.SubscribeConsole(\u0026#34;names\u0026#34;); ä½ å°†ä¼šå¾—åˆ°ï¼š\n1 2 3 4 5 names - OnNext(AHpx) names - OnNext(Yoroion) names - OnNext(Weekenic) names - OnNext(GodLeaveMe) names - OnCompleted() å¦‚æœè¿­ä»£çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£ä¹ˆæŠ¥é”™å°±ä¼šä¼ é€’è‡³ OnError æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 class Program { static void Main(string[] args) { NumbersAndThrow() .ToObservable() .SubscribeConsole(\u0026#34;names\u0026#34;); Console.ReadLine(); } static IEnumerable\u0026lt;int\u0026gt; NumbersAndThrow() { yield return 1; yield return 2; yield return 3; throw new ApplicationException(\u0026#34;æŠ¥é”™å•¦\u0026#34;); yield return 4; } } è¾“å‡ºï¼š\n1 2 3 4 5 enumerable with exception - OnNext(1) enumerable with exception - OnNext(2) enumerable with exception - OnNext(3) enumerable with exception - OnError: System.ApplicationException: Something Bad Happened Rx è¿˜æä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥è®¢é˜…è¿­ä»£ç±»å‹ï¼š\n1 2 IEnumerable\u0026lt;string\u0026gt; names = new[] { \u0026#34;AHpx\u0026#34;, \u0026#34;Yoroion\u0026#34;, \u0026#34;Weeknic\u0026#34;, \u0026#34;GodLeaveMe\u0026#34; }; names.Subscribe(new ConsoleObserver\u0026lt;string\u0026gt;(\u0026#34;subscribe\u0026#34;)); é‚£ä¹ˆå¦‚ä½•åˆå¹¶å¯è§‚å¯Ÿæ•°æ®æµä¸è¿­ä»£ç±»å‹å‘¢ï¼Ÿ\n1 2 3 4 5 6 7 ChatClient client = new ChatClient(); IObservable\u0026lt;string\u0026gt; liveMessages = client.ObserveMessages(\u0026#34;user\u0026#34;,\u0026#34;pass\u0026#34;); IEnumerable\u0026lt;string\u0026gt; loadedMessages = LoadMessagesFromDB(); // å‡è®¾ä»æ•°æ®åº“åŠ è½½æ•°æ® loadedMessages.ToObservable() .Concat(liveMessages) .SubscribeConsole(\u0026#34;merged\u0026#34;); æ³¨æ„çœ‹ï¼Œä»¥ä¸Šä»£ç ä½¿ç”¨äº† Concat åˆå¹¶äº†ä¸¤ä¸ªæµã€‚åœ¨æ‰€æœ‰ Database æ•°æ®ï¼ˆLoaded Messagesï¼‰è¢«åŠ è½½åï¼Œå®æ—¶æ•°æ®ï¼ˆLive Messagesï¼‰æ‰ä¼šè¢«å‘ç»™è§‚å¯Ÿè€…ã€‚\n1 2 3 4 merged - OnNext(loaded1) merged - OnNext(loaded2) merged - OnNext(live message1) merged - OnNext(live message2) ä½ ä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹å†™æ³•å…äºæ‰‹åŠ¨è½¬æ¢ï¼š\n1 2 3 liveMessages .StartWith(loadedMessages) .SubscribeConsole(\u0026#34;loaded first\u0026#34;); å¯è§‚å¯Ÿæµ â†’ è¿­ä»£ç±»å‹ ä¸ºå•¥è¦æŠŠå¯è§‚å¯Ÿæµè½¬åŒ–æˆè¿­ä»£ç±»å‹å‘¢ï¼Ÿå› ä¸ºæœ‰çš„æ–¹æ³•åªæ¥å—è¿­ä»£ç±»å‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 var observable = Observable.Create\u0026lt;string\u0026gt;(o =\u0026gt; { o.OnNext(\u0026#34;Observable\u0026#34;); o.OnNext(\u0026#34;To\u0026#34;); o.OnNext(\u0026#34;Enumerable\u0026#34;); o.OnCompleted(); // å½“æ‰€æœ‰OnNextä¸­çš„å€¼è¢«æ¶ˆè´¹åï¼Œçº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ return Disposable.Empty; }); var enumerable = observable.ToEnumerable(); // å¯è§‚å¯Ÿæµå®Œæˆæ—¶ï¼Œå¾ªç¯ä¾¿ä¼šç»“æŸ foreach (var item in enumerable) { Console.WriteLine(item); } æŠŠå¯è§‚å¯Ÿæµè½¬æ¢æˆ Listï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 var observable = Observable.Create\u0026lt;string\u0026gt;(o =\u0026gt; { o.OnNext(\u0026#34;Observable\u0026#34;); o.OnNext(\u0026#34;To\u0026#34;); o.OnNext(\u0026#34;List\u0026#34;); o.OnCompleted(); // åªæœ‰å½“Completeä¹‹åï¼ŒListæ‰ä¼šè¢«å‘é€ç»™è§‚å¯Ÿè€… return Disposable.Empty; }); IObservable\u0026lt;IList\u0026lt;string\u0026gt;\u0026gt; listObservable = observable.ToList(); listObservable .Select(lst =\u0026gt; string.Join(\u0026#34;,\u0026#34;, lst)) // ä½¿ç”¨é€—å·åˆ†éš” .SubscribeConsole(\u0026#34;list ready\u0026#34;); è¾“å‡ºï¼š\n1 2 list ready - OnNext(Observable,To,List) list ready - OnCompleted() å¯è§‚å¯Ÿæµ â†’ å­—å…¸ Rx æä¾›äº†å¦‚ä¸‹æ–¹æ³•ï¼š\n1 IObservable\u0026lt;IDictionary\u0026lt;TKey, TSource\u0026gt;\u0026gt; ToDictionary\u0026lt;TSource, TKey\u0026gt;(this IObservable\u0026lt;TSource\u0026gt; source, Func\u0026lt;TSource, TKey\u0026gt; keySelector) ç®€å•ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 IEnumerable\u0026lt;string\u0026gt; cities = new[] { \u0026#34;London\u0026#34;, \u0026#34;Tel-Aviv\u0026#34;, \u0026#34;Tokyo\u0026#34;, \u0026#34;Rome\u0026#34; }; var dictionaryObservable = cities .ToObservable() .ToDictionary(c =\u0026gt; c.Length); dictionaryObservable .Select(d =\u0026gt; string.Join(\u0026#34;,\u0026#34;, d)) .SubscribeConsole(\u0026#34;dictionary\u0026#34;); è¾“å‡ºï¼š\n1 2 dictionary - OnNext([6, London],[8, Tel-Aviv],[5, Tokyo],[4, Rome]) dictionary - OnCompleted() ä½†æ˜¯å½“ä¸¤ä¸ª Key çš„å€¼ç›¸åŒæ—¶ï¼Œå®ƒå°±ä¼šæŠ¥é”™ã€‚\nå¦‚æœä½ éœ€è¦ä¸€ Key å¯¹åº”å¤šå€¼ï¼Œä½ å°±éœ€è¦ Lookup ç±»å‹ï¼š\n1 IObservable\u0026lt;ILookup\u0026lt;TKey, TSource\u0026gt;\u0026gt; ToLookup\u0026lt;TSource, TKey\u0026gt;(this IObservable\u0026lt;TSource\u0026gt; source, Func\u0026lt;TSource, TKey\u0026gt; keySelector) é•¿å¾—å’Œ ToDictionary éå¸¸ç›¸ä¼¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 IEnumerable\u0026lt;string\u0026gt; cities = new[] { \u0026#34;London\u0026#34;, \u0026#34;Tel-Aviv\u0026#34;, \u0026#34;Tokyo\u0026#34;, \u0026#34;Rome\u0026#34;, \u0026#34;Madrid\u0026#34; }; var lookupObservable = cities .ToObservable() .ToLookup(c =\u0026gt; c.Length); lookupObservable .Select(lookup =\u0026gt; { var groups = new StringBuilder(); foreach (var grp in lookup) groups.AppendFormat(\u0026#34;[Key:{0} =\u0026gt; {1}]\u0026#34;,grp.Key,grp.Count()); return groups.ToString(); }) .SubscribeConsole(\u0026#34;lookup\u0026#34;); è¾“å‡ºï¼š\n1 2 lookup - OnNext([Key:6 =\u0026gt; 2][Key:8 =\u0026gt; 1][Key:5 =\u0026gt; 1][Key:4 =\u0026gt; 1]) lookup - OnCompleted() å› ä¸ºä¼¦æ•¦ï¼ˆLondonï¼‰å’Œé©¬å¾·é‡Œï¼ˆMadridï¼‰çš„é•¿åº¦éƒ½æ˜¯ 6ï¼ŒLookup Key 6 å°±æœ‰ä¸¤ä¸ªå€¼ã€‚\nRx åˆ›å»ºå‹æ“ä½œç¬¦ å¯è§‚å¯Ÿå¾ªç¯ ä½¿ç”¨ Observable.Generate æ¥åˆ›å»ºç±»ä¼¼è¿­ä»£çš„æ•°æ®æµï¼š\n1 2 3 4 5 IObservable\u0026lt;TResult\u0026gt; Generate\u0026lt;TState, TResult\u0026gt;( TState initialState, Func\u0026lt;TState, bool\u0026gt; condition, Func\u0026lt;TState, TState\u0026gt; iterate, Func\u0026lt;TState, TResult\u0026gt; resultSelector) ç®€å•ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 IObservable\u0026lt;int\u0026gt; observable = Observable.Generate( 0, //åˆå§‹å€¼ i =\u0026gt; i \u0026lt; 10, //æ¡ä»¶ i =\u0026gt; i + 1, //è¿­ä»£ i =\u0026gt; i*2); //æ•°æ®å¤„ç† observable.SubscribeConsole(); ä½ ä¼šå¾—åˆ°ï¼š0, 2, 4, 6, 8, 10, 12, 14, 16, 18ã€‚\nä½¿ç”¨ Observable.Range ç®€åŒ–ä»¥ä¸Šæ“ä½œï¼š\n1 IObservable\u0026lt;int\u0026gt; Range(int start, int count) é¡¾åæ€ä¹‰ï¼š\n1 2 3 4 IObservable\u0026lt;int\u0026gt; observable = Observable .Range(0, 10) .Select(i =\u0026gt; i*2); è¯»å–æ–‡ä»¶ æˆ‘ä»¬åˆ©ç”¨ Generate æ–¹æ³•æ¥è¯»å–æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 IObservable\u0026lt;string\u0026gt; lines = Observable.Generate( File.OpenText(\u0026#34;TextFile.txt\u0026#34;), //è¿™ä¸ªåœ°æ–¹æœ‰ç‘•ç–µ s =\u0026gt; !s.EndOfStream, //è¿­ä»£åˆ°æ–‡ä»¶æœ«ç«¯ s =\u0026gt; s, //çŠ¶æ€å°±æ˜¯æ–‡ä»¶æµæœ¬èº« s =\u0026gt; s.ReadLine()); lines.SubscribeConsole(\u0026#34;lines\u0026#34;); è¾“å‡ºï¼š\n1 2 3 4 5 lines - OnNext(The 1st line) lines - OnNext(The 2nd line) lines - OnNext(The 3rd line) lines - OnNext(The 4th line) lines - OnCompleted() ä½†æ˜¯æï¼Œæˆ‘ä»¬è‚¯å®šçŸ¥é“ IO æµçš„èµ„æºæ²¡æœ‰åŠæ—¶é‡Šæ”¾ã€‚æ–‡ä»¶è¿˜ä¿æŒåœ¨æ‰“å¼€çš„çŠ¶æ€ã€‚\nåœ¨å¹³æ—¶å†™ C# ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ using var ... æ¥è‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚\nåœ¨ Rx.NET ä¸­ï¼Œæä¾›äº† Observable.Usingï¼š\n1 2 3 4 5 6 7 8 9 10 11 IObservable\u0026lt;string\u0026gt; lines = Observable.Using( () =\u0026gt; File.OpenText(\u0026#34;TextFile.txt\u0026#34;), stream =\u0026gt; Observable.Generate( stream, //åˆå§‹çŠ¶æ€å°±æ˜¯å®ƒè‡ªå·± s =\u0026gt; !s.EndOfStream, s =\u0026gt; s, s =\u0026gt; s.ReadLine()) ); lines.SubscribeConsole(\u0026#34;lines\u0026#34;); åŸå§‹å¯è§‚å¯Ÿæµ æœ‰äº› Rx åˆ›å»ºå‹æ“ä½œç¬¦æ²¡å•¥ç”¨ï¼Œä½†æ˜¯å¯ä»¥æ‹¿æ¥ç©ç©æˆ–è€…æµ‹è¯•ã€‚\nReturn 1 2 Observable.Return(\u0026#34;Hello World\u0026#34;) .SubscribeConsole(\u0026#34;Return\u0026#34;); è¾“å‡ºï¼š\n1 2 Return - OnNext(Hello World) Return - OnCompleted() Never ä¸€ä¸ªæ°¸ä¸ç»“æŸçš„æ•°æ®æµï¼š\n1 2 Observable.Never\u0026lt;string\u0026gt;() .SubscribeConsole(\u0026#34;Never\u0026#34;); Throw ä¸€ä¸ªè¿è¡Œå³æŠ¥é”™çš„æµï¼š\n1 2 3 Observable.Throw\u0026lt;ApplicationException\u0026gt;( new ApplicationException(\u0026#34;something bad happened\u0026#34;)) .SubscribeConsole(\u0026#34;Throw\u0026#34;); è¾“å‡ºï¼š\n1 2 Throw - OnError: System.ApplicationException: something bad happened Empty 1 2 Observable.Empty\u0026lt;string\u0026gt;() .SubscribeConsole(\u0026#34;Empty\u0026#34;); è¾“å‡ºï¼š\n1 Empty - OnCompleted() ","date":"2022-08-10T00:00:00Z","image":"https://yoroion.github.io/p/rx-magic-3/head_hu60daa3e750dae8efe162b164d024055e_222411_120x120_fill_box_smart1_3.png","permalink":"https://yoroion.github.io/p/rx-magic-3/","title":"Rx.NET å“åº”å¼ç¼–ç¨‹æŒ‡åŒ— 03 - æ·±å…¥æµçš„åˆ›å»º"},{"content":"å‰è¨€ è¿™ä¸€ç« æ˜¯ç‹¬ç«‹äºæ­£å¼ç« èŠ‚çš„ç•ªå¤–ï¼Œè¡¥å……ä¸€ä¸‹ C# å‡½æ•°å¼ç¼–ç¨‹ï¼ˆFunctional Programmingï¼‰ä»¥åŠæµå¼æ¥å£ï¼ˆFluent APIï¼‰çš„çŸ¥è¯†ã€‚\nç­‰ç­‰ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨å­¦ Rx.NET å—ï¼Œæ€ä¹ˆåˆè·‘åˆ°å‡½æ•°å¼äº†ï¼Ÿ (ï¼ƒÂ°Ğ”Â°)\nä½  å…ˆ åˆ« æ€¥ï¼ŒäºŒè€…å¹¶ä¸å†²çªã€‚\nRx.NET æä¾›çš„æ–¹æ³•å¤§éƒ¨åˆ†éƒ½æ˜¯å‡½æ•°å¼çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€ç« å­¦åˆ°çš„ FromEventPattern æ–¹æ³•ï¼Œå°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼ˆHigh-Order Functionï¼‰ï¼Œå› ä¸ºå®ƒçš„å‚æ•°ä¹Ÿæ˜¯å‡½æ•°ã€‚\næœ‰äº›è€å¤è‘£ Java ç¨‹åºå‘˜è®¤ä¸ºï¼ŒC# å’Œ Java ä¸€æ ·éƒ½æ˜¯çº¯é¢å‘å¯¹è±¡è¯­è¨€ï¼ˆPure OOPï¼‰ï¼Œè¿™æ˜¯å®Œå…¨é”™è¯¯çš„ã€‚ç»è¿‡äºŒåå¹´çš„å‘å±•ï¼ŒC# æ—©å·²è¿›åŒ–æˆä¸€é—¨å¤šèŒƒå¼è¯­è¨€äº†ã€‚\nå‡½æ•°å¼ç¼–ç¨‹ é‚£ä¹ˆå¦‚ä½•ç”¨ C# ç¼–å†™å‡½æ•°å¼ä»£ç å‘¢ï¼Ÿ\nå›é¡¾ä¸€ä¸‹åŸºç¡€çŸ¥è¯†å§ã€‚\nå§”æ‰˜ Delegate ä¸ºäº†ä¼ é€’å‡½æ•°ï¼ŒC# è€æ—©å°±åŠ å…¥äº†å§”æ‰˜ç‰¹æ€§ï¼š\n1 public delegate bool MyDelegateType (string first, string second); åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º MyDelegateType çš„å§”æ‰˜ç±»å‹ã€‚\næˆ‘ä»¬è¿™æ ·ä¸ºå§”æ‰˜èµ‹å€¼ï¼š\n1 2 3 4 MyDelegateType myDel; myDel += \u0026lt;ä¸€äº›å‡½æ•°\u0026gt;; myDel(\u0026#34;first\u0026#34;, \u0026#34;second\u0026#34;); // è¿™æ ·è°ƒç”¨ åŒ¿åæ–¹æ³• Anonymous methods 1 2 3 4 myDel = delegate (string first, string second) { return first.Length == second.Length; } Lambda è¡¨è¾¾å¼ 1 2 3 4 5 // ğŸ‘‡ è¿™å°±æ˜¯ lambda MyDelegateType x = (s1,s2) =\u0026gt; s1 == s2; // ğŸ‘‡ åŒ¿åå‡½æ•° MyDelegateType y = delegate (string s1,string s2) { return s1 == s2; }; Func å’Œ Action è¿™ä¿©éƒ½æ˜¯ .NET é¢„å®šä¹‰å¥½çš„æ ‡å‡†å§”æ‰˜ç±»å‹ã€‚\nä¹Ÿå°±æ˜¯è¯´åˆ«å‚»ä¹ä¹åœ°è‡ªå·±å®šä¹‰å§”æ‰˜ç±»å‹å•¦ï¼Œç”¨å®ƒä¿©å°±å¥½äº†ã€‚\n.NET é¢„å®šä¹‰äº† 17 ç§ Func å’Œ Action å§”æ‰˜ï¼Œå…¨æ”¾åœ¨ System åç§°ç©ºé—´ä¸‹ã€‚\nAction Action ç”¨äºæ— è¿”å›å€¼çš„å‡½æ•°å§”æ‰˜ã€‚\nçœ‹çœ‹å®šä¹‰ï¼š\n1 2 3 4 // ğŸ‘‡ æ— å‚ public delegate void Action(); // ğŸ‘‡ ä¸¤ä¸ªå‚æ•° public delegate void Action\u0026lt;in T1, in T2\u0026gt;(T1 arg1, T2 arg2); ç®€å•ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 public static void ForEach\u0026lt;T\u0026gt;(IEnumerable\u0026lt;T\u0026gt; collection, Action\u0026lt;T\u0026gt; action) { foreach (var item in collection) { action(item); } } // ğŸ‘‡ å®Œæ•´ä½¿ç”¨ ForEach(new[] { \u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34; }, n =\u0026gt; Console.WriteLine(n)); // ğŸ‘‡ çœç•¥å½¢å¼ ForEach(new[] { \u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34; }, Console.WriteLine); Func Func ç”¨äºæœ‰è¿”å›å€¼çš„å‡½æ•°å§”æ‰˜ã€‚\nçœ‹çœ‹å®šä¹‰ï¼š\n1 2 public delegate TResult Func\u0026lt;out TResult\u0026gt;(); public delegate TResult Func\u0026lt;in T1,â€¦,T16, out TResult\u0026gt;(T1 arg,â€¦,T16 arg16); ç®€å•ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 public static void ForEach\u0026lt;T\u0026gt;(IEnumerable\u0026lt;T\u0026gt; collection, Action\u0026lt;T\u0026gt; action, Func\u0026lt;T, bool\u0026gt; predicate) { foreach (var item in collection) { if (predicate(item)) { action(item); } } } æ‡’åŠ è½½ Lazy\u0026lt;T\u0026gt; æˆ‘ä»¬æ¥çœ‹çœ‹ Func ä½œä¸ºå·¥å‚å‡½æ•°çš„ä½œç”¨å§ã€‚\nä½ æœ‰ä¸€ä¸ªå¾ˆè€—æ—¶çš„ç±»ï¼š\n1 2 3 4 class HeavyClass { // åˆå§‹åŒ–éå¸¸è€—æ—¶ } ä½ è¿˜æœ‰ä¸ªç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 class ThinClass { private HeavyClass _heavy; public HeavyClass TheHeavy { get { if (_heavy == null) { _heavy = new HeavyClass(); // å»¶è¿ŸåŠ è½½æ—¶é—´ } return _heavy; } } public void SomeMethod() { var myHeavy = TheHeavy; // çœç•¥åé¢çš„ä½¿ç”¨ } } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™å°±æ˜¯åœ¨ Java ä¸­å¸¸è§çš„æ„å»ºæ¨¡å¼ã€‚\né‚£å¦‚æœä½ æœ‰ 10 ä¸ªéœ€è¦å»¶è¿ŸåŠ è½½çš„å±æ€§å‘¢ï¼Ÿåƒè¿™æ ·ä¸€ä¸€æ‰‹å†™ get æ–¹æ³•æœªå…ä¹Ÿå¤ªæŠ˜ç£¨äº†ã€‚\nå¤ªç¬¨äº†ï¼Œåœ¨ C# ä¸­æ‰ä¸è¿™ä¹ˆåšï¼\næˆ‘ä»¬æ¥ä½¿ç”¨ System ç©ºé—´ä¸‹çš„æ‡’åŠ è½½ç±» Lazy\u0026lt;T\u0026gt;ï¼š\n1 2 3 4 5 6 7 8 9 10 class ClassWithLazy { Lazy\u0026lt;HeavyClass\u0026gt; _lazyHeavyClass = new Lazy\u0026lt;HeavyClass\u0026gt;(); public void SomeMethod() { var myHeavy = _lazyHeavyClass.Value; //ä½¿ç”¨ myHeavy } } é‚£å¦‚æœ HeavyClass ç±»çš„æ„é€ æ–¹æ³•éœ€è¦å‚æ•°å’‹åŠï¼Ÿ\nä¼ é€’ä¸ª Func ç»™å®ƒï¼š\n1 2 3 4 5 6 Lazy\u0026lt;HeavyClass\u0026gt; _lazyHeavyClass = new Lazy\u0026lt;HeavyClass\u0026gt;(() =\u0026gt; { var heavy = new HeavyClass(...); ... return heavy; }); æµå¼æ¥å£ Fluent API æµå¼æ¥å£ï¼ˆFluent APIï¼‰æ˜¯ä¸€ç§æ–¹æ³•è°ƒç”¨é£æ ¼ï¼š\n1 2 3 4 5 6 7 StringBuilder sbuilder = new StringBuilder(); var result = sbuilder .AppendLine(\u0026#34;Fluent\u0026#34;) .AppendLine(\u0026#34;Interfaces\u0026#34;) .AppendLine(\u0026#34;Are\u0026#34;) .AppendLine(\u0026#34;Awesome\u0026#34;) .ToString(); çœ‹çœ‹ç ´æ™“çš„ ModuleLauncher.Re æ˜¯æ€ä¹ˆå†™çš„å§ï¼šç ´æ™“æ‰“é’±ï¼\n1 2 3 var process = await minecraft.WithAuthentication(\u0026#34;\u0026lt;player\u0026gt;\u0026#34;) .WithJava(@\u0026#34;\u0026lt;java\u0026gt;\u0026#34;) .LaunchAsync(); æ¥ä¸‹æ¥æˆ‘ä»¬åŠ¨æ‰‹å†™ä¸€ä¸ªæµå¼æ¥å£ã€‚\næˆ‘ä»¬å¹³å¸¸ä¸º List æ·»åŠ å…ƒç´ ï¼š\n1 2 3 4 var words = new List\u0026lt;string\u0026gt;(); words.Add(\u0026#34;This\u0026#34;); words.Add(\u0026#34;Feels\u0026#34;); words.Add(\u0026#34;Weird\u0026#34;); ä¸å¤Ÿä¼˜é›…ï¼ç”¨æµå¼æ¥å£å†™ä¸ªæ‰©å±•æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 public static class ListExtensions { public static List\u0026lt;T\u0026gt; AddItem\u0026lt;T\u0026gt;(this List\u0026lt;T\u0026gt; list, T item) { list.Add(item); return list; } } ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ–¹æ³•é“¾äº†ï¼š\n1 2 3 4 var words = new List\u0026lt;string\u0026gt;(); words.AddItem(\u0026#34;This\u0026#34;) .AddItem(\u0026#34;Feels\u0026#34;) .AddItem(\u0026#34;Weird\u0026#34;); Awesomeï¼ç¬é—´å°±ç®€æ´å¤šäº†ã€‚\n","date":"2022-08-09T00:00:00Z","image":"https://yoroion.github.io/p/rx-magic-ex/head_hu60daa3e750dae8efe162b164d024055e_222411_120x120_fill_box_smart1_3.png","permalink":"https://yoroion.github.io/p/rx-magic-ex/","title":"Rx.NET å“åº”å¼ç¼–ç¨‹æŒ‡åŒ— Ex - å‡½æ•°å¼æ€æƒ³ \u0026 æµå¼æ¥å£"},{"content":"å‰è¨€ åœ¨ä¸Šä¸€ç« é‡Œï¼Œæˆ‘ä»¬å­¦ä¹ äº†å“åº”å¼çš„åŸºæœ¬æ¦‚å¿µã€‚åœ¨è¿™ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªè‚¡ç¥¨ç›‘æ§ç¨‹åºã€‚é¦–å…ˆæˆ‘ä»¬å°†ä½¿ç”¨ä¼ ç»Ÿçš„ .NET äº‹ä»¶ç³»ç»Ÿæ¥å†™ä¸€æ¬¡ï¼Œä¹‹åå†é€šè¿‡ Rx æ¥é‡æ„ã€‚\nä¼ ç»Ÿäº‹ä»¶å†™æ³• å…ˆç¼–å†™ä¸€ä¸ªç±»ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªäº‹ä»¶å±æ€§ï¼š 1 2 3 4 class StockTicker { public event EventHandler\u0026lt;StockTick\u0026gt; StockTick; } ç¼–å†™ä¸€ä¸ªç±»åŒ…å«æˆ‘ä»¬çš„æ•°æ®ï¼š 1 2 3 4 5 class StockTick { public string QuoteSymbol { get; set; } public decimal Price { get; set; } } åˆ›å»ºä¸€ä¸ªç±»æ¥ç›‘å¬å˜åŒ–ï¼Œå¹¶è®¢é˜…äº‹ä»¶ï¼š 1 2 3 4 5 6 7 8 class StockMonitor { public StockMonitor(StockTicker ticker) { ticker.StockTick += OnStockTick; // OnStockTick æ³¨å†Œäº‹ä»¶ } ... } å› ä¸ºæˆ‘ä»¬éœ€è¦æ¯”è¾ƒè‚¡ç¥¨ä»·æ ¼çš„å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å­—å…¸æ¥å­˜å‚¨å…ˆå‰çš„è‚¡ç¥¨æ•°æ®ã€‚ç¼–å†™ä¸€ä¸ªæ–°ç±»ï¼š 1 2 3 4 5 6 7 8 9 10 class StockInfo { public StockInfo(string symbol, decimal price) { Symbol = symbol; PrevPrice = price; } public string Symbol { get; set; } public decimal PrevPrice { get; set; } } ä¹‹åä½ å¯ä»¥åœ¨ StockMonitor ä¸­å£°æ˜ä¸€ä¸ª StockInfo ç±»å‹çš„å±æ€§ã€‚\næ¯å½“è‚¡ç¥¨å˜åŒ–æ—¶ï¼ŒOnStockTick å°±ä¼šè¢«è°ƒç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„åº”ç”¨è¿˜è¦å®ç°ä¸€ä¸ªæ–°æ—§æ•°æ®æ¯”è¾ƒçš„åŠŸèƒ½ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ TryGetValue æ–¹æ³•ã€‚å½“æˆ‘ä»¬æƒ³è¦çš„å€¼å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª trueã€‚åœ¨ StockMonitor ä¸­ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 var _stockInfos = new Dictionary\u0026lt;string, StockInfo\u0026gt;(); void OnStockTick(object sender, StockTick stockTick) { StockInfo stockInfo; var quoteSymbol = stockTick.QuoteSymbol; var stockInfoExists = _stockInfos.TryGetValue(quoteSymbol, out stockInfo); ... } å¦‚æœä¸€ä¸ªè‚¡ç¥¨æ•°æ®å­˜åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¯”è¾ƒå¤§å°äº†ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 const decimal maxChangeRatio = 0.1m; ... var quoteSymbol = stockTick.QuoteSymbol; var stockInfoExists = _stockInfos.TryGetValue(quoteSymbol, out stockInfo); if (stockInfoExists) { var priceDiff = stockTick.Price-stockInfo.PrevPrice; // å˜åŒ–çš„ç™¾åˆ†æ¯” var changeRatio = Math.Abs(priceDiff/stockInfo.PrevPrice); if (changeRatio \u0026gt; maxChangeRatio) { // ç®€å•æ‰“å°ä¸ªä¿¡æ¯ï¼Œç”¨çš„æ˜¯ C# 6.0 ä»¥å‰çš„å†™æ³• Console.WriteLine(\u0026#34;Stock:{0} has changed with {1} ratio, Old Price:{2} New Price:{3}\u0026#34;, quoteSymbol, changeRatio, stockInfo.PrevPrice, stockTick.Price); } //ä¿å­˜è¿™ä¸ªæ–°æ•°æ® _stockInfos[quoteSymbol].PrevPrice = stockTick.Price; } é‚£å¦‚æœæˆ‘ä»¬ä¸æƒ³è¦è®¢é˜…è‚¡ç¥¨æ¶ˆæ¯äº†å’‹åŠï¼Ÿå¹¸è¿çš„æ˜¯ .NET æä¾›äº†æ–¹æ³•æ¥å¹²è¿™ä¸ªæ´»ã€‚åœ¨ StockMonitor é‡Œç¼–å†™ä»¥ä¸‹æ–¹æ³•ï¼š 1 2 3 4 5 public void Dispose() { _ticker.StockTick -= OnStockTick; _stockInfos.Clear(); } å†™ä¸€ç‚¹å‡æ•°æ®ï¼Œæµ‹è¯•ä¸€ä¸‹ç»“æœï¼š 1 2 3 4 5 6 7 8 9 // çç¼–çš„ Symbol: \u0026#34;MSFT\u0026#34; Price: 100 Symbol: \u0026#34;INTC\u0026#34; Price: 150 Symbol: \u0026#34;MSFT\u0026#34; Price: 170 Symbol: \u0026#34;MSFT\u0026#34; Price: 195 // è¿è¡Œç»“æœ Stock:MSFT has changed with 0.7 ratio, Old Price:100 New Price:170 Stock:MSFT has changed with 0.15 ratio, Old Price:170 New Price:195.5 å“‡å“¦ï¼Œæ„Ÿè§‰è¿˜ä¸é”™å˜›ï¼\nä½†æ˜¯è¿™ä¹ˆå†™å°±ä¸€ç‚¹é—®é¢˜æ²¡æœ‰å—ï¼Ÿ\nå¹¶å‘é—®é¢˜ æˆ‘ä»¬çš„ç¨‹åºè¿è¡Œèµ·æ¥æ²¡å•¥é—®é¢˜ï¼Œä½†èƒŒåæœ‰ä¸ªä¸¥é‡æ¼æ´ï¼š\nä¸æ˜¯å¹¶å‘çš„ï¼\nå¦‚æœ StockMonitor è¿è¡ŒæœŸé—´åˆæœ‰æ–°çš„è‚¡ç¥¨å˜åŒ–å’‹åŠï¼Ÿ\nå¾ˆæŠ±æ­‰ï¼Œåªèƒ½ç­‰ç€ç¬¬ä¸€æ¬¡ç¨‹åºç»“æŸã€‚\nçº¿ç¨‹ä¸å®‰å…¨ è™½ç„¶æˆ‘ä»¬çš„ StockInfo å­—å…¸æ”¯æŒå¤šè¯»è€…ï¼ˆMultiple Readersï¼‰åŒæ—¶è¯»å–ï¼Œä½†å½“æˆ‘ä»¬è¯»å–å­—å…¸æ—¶å­—å…¸æ­£åœ¨è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚\nè¿™æ˜¯ä½ å¯èƒ½ä¼šè¯´ï¼Œå¯ä»¥æ”¹ç”¨ .NET æä¾›çš„æ— é” ConcurrentDictionary å‘€ï¼è¿™æ ·å°±ä¸æŠ¥é”™äº†ã€‚\nä½†æ˜¯ï¼Œé‚£æˆ‘ä»¬æ¯æ¬¡æ¯”è¾ƒçš„æ–°å€¼åˆæ˜¯è°ï¼Ÿæ˜¯ä¿®æ”¹å‰çš„ï¼Œè¿˜æ˜¯ä¿®æ”¹åçš„ï¼Ÿ\nä½ å¯èƒ½åˆä¼šè¯´ï¼Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹é”ï¼ˆThread Lockï¼‰æ¥é˜»å¡ä¸¤ä¸ªåŒæ—¶å‘ç”Ÿçš„çº¿ç¨‹çš„å…¶ä¸­ä¸€ä¸ªã€‚\nå¯æ˜¯å¦‚æœèµ„æºä¸åŠæ—¶é‡Šæ”¾ï¼Œåˆå¾ˆå®¹æ˜“å¯¼è‡´æ­»é”é—®é¢˜ã€‚\nå“åº”å¼å†™æ³• ä½¿ç”¨ Rx çš„è¯ï¼Œä¼ ç»Ÿäº‹ä»¶å†™æ³•æš´éœ²å‡ºçš„é—®é¢˜å¯ä»¥é€šè¿‡æ›´ç®€å•çš„æ–¹å¼è§£å†³ã€‚\nå®‰è£… Rx.NET ä½ éƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œç›¸ä¿¡å’‹å®‰è£…æ ¹æœ¬ä¸ç”¨æˆ‘æ•™ä½ ã€‚\nRx.NET æ”¾åœ¨ System.Reactive åç§°ç©ºé—´ä¸‹ã€‚\näº‹ä»¶è½¬æ¢ Rx.NET æä¾›äº†å¥½ç”¨çš„ FromEventPattern æ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬å°†äº‹ä»¶è½¬æ¢æˆå¯è§‚å¯Ÿå¯¹è±¡ï¼ˆObservableï¼‰ï¼š\n1 2 3 4 IObservable\u0026lt;EventPattern\u0026lt;StockTick\u0026gt;\u0026gt; ticks = Observable.FromEventPattern\u0026lt;EventHandler\u0026lt;StockTick\u0026gt;, StockTick\u0026gt;( h =\u0026gt; ticker.StockTick += h, h =\u0026gt; ticker.StockTick -= h); è°”è°”ï¼Œçœ‹ä¸æ‡‚æ\u0026hellip;\né‚£æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®šä¹‰å§ï¼š\n1 FromEventPattern\u0026lt;TDelegate,TEventArgs(Action\u0026lt;TDelegate\u0026gt;addHandler, Action\u0026lt;TDelegate\u0026gt; removeHandler) TDelegate æ˜¯åŒ¹é…äº‹ä»¶çš„å§”æ‰˜ â†’ EventHandler\u0026lt;StockTick\u0026gt; TEventArgs å°±æ˜¯ EventArgs â†’ StockTick addHandler å’Œ removeHandler ä¸€èˆ¬å°±ç›´æ¥å†™æˆ Lambda è¡¨è¾¾å¼çš„å½¢å¼ å› ä¸ºæˆ‘ä»¬åªå…³å¿ƒä¼ å…¥çš„ EventArgsï¼Œæ‰€ä»¥ä»£ç å¯ä»¥æ”¹å†™æˆï¼š\n1 2 3 4 var ticks = Observable.FromEventPattern\u0026lt;EventHandler\u0026lt;StockTick\u0026gt;, StockTick\u0026gt;( h =\u0026gt; ticker.StockTick += h, h =\u0026gt; ticker.StockTick -= h) .Select(tickEvent =\u0026gt; tickEvent.EventArgs); æ•°æ®å¤„ç† ç°åœ¨ä½ å·²ç»æœ‰äº†ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®æµäº†ï¼Œæˆ‘ä»¬å°†å›´ç»•å®ƒå±•å¼€æŸ¥è¯¢æ“ä½œï¼Œå°±åƒ LINQ ä¸€æ ·ã€‚\nåˆ†ç»„ Group æˆ‘ä»¬è¯•ç€é€šè¿‡ Symbol æ¥ä¸ºæ¯æ”¯è‚¡ç¥¨åˆ†ç»„ï¼š\n1 2 3 4 5 6 // æŸ¥è¯¢è¯­å¥å½¢å¼ from tick in ticks group tick by tick.QuoteSymbol into company // å‡½æ•°å½¢å¼ ticks.GroupBy(tick =\u0026gt; tick.QuoteSymbol); åˆ†æ‰¹ Buffer Buffer ç”¨äºåŒç»„å†…å†åˆ†æ‰¹ï¼ˆBatchï¼‰ã€‚\nåœ¨è¿™é‡Œæ˜¯åŒç»„å†…æ•°æ®ä¸¤ä¸¤å‰åæ¯”è¾ƒï¼š\n1 2 3 4 5 from tick in ticks group tick by tick.QuoteSymbol into company from tickPair in company.Buffer(2, 1) let changeRatio = Math.Abs((tickPair[1].Price - tickPair[0].Price) / tickPair[0].Price) æœ€åå…¨éƒ¨çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 const decimal maxChangeRatio = 0.1 m; var drasticChanges = from tick in ticks group tick by tick.QuoteSymbol into company from tickPair in company.Buffer(2, 1) let changeRatio = Math.Abs((tickPair[1].Price - tickPair[0].Price) / tickPair[0].Price) where changeRatio \u0026gt; maxChangeRatio select new DrasticChange() { Symbol = company.Key, ChangeRatio = changeRatio, OldPrice = tickPair[0].Price, NewPrice = tickPair[1].Price }; æ¶ˆè´¹æ•°æ® 1 2 3 4 5 6 7 8 _subscription = drasticChanges.Subscribe(change =\u0026gt; { Console.WriteLine($\u0026#34;Stock:{change.Symbol} has changed with {change.ChangeRatio} ratio, Old Price: {change.OldPrice} New Price: {change.NewPrice}\u0026#34;); }, ex =\u0026gt; { /* å¤„ç†é”™è¯¯ */}, () =\u0026gt; {/* å“åº”ä»»åŠ¡å®Œæˆ */}); å–æ¶ˆè®¢é˜… 1 2 3 4 public void Dispose() { _subscription.Dispose(); } åŒæ­¥æµ è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿçš„é—®é¢˜å—ï¼Ÿ\nå¼‚æ­¥ IO ä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ã€‚\nå› æ­¤æˆ‘ä»¬è¦å°†æˆ‘ä»¬çš„ ticks å¯è§‚å¯Ÿæ•°æ®æµè½¬æ¢æˆåŒæ­¥çš„ï¼š\n1 2 3 4 5 var ticks = Observable.FromEventPattern\u0026lt;EventHandler\u0026lt;StockTick\u0026gt;, StockTick\u0026gt;( h =\u0026gt; ticker.StockTick += h, h =\u0026gt; ticker.StockTick -= h) .Select(tickEvent =\u0026gt; tickEvent.EventArgs) .Synchronize(); æ€»è§ˆä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 class RxStockMonitor : IDisposable { private IDisposable _subscription; public RxStockMonitor(StockTicker ticker) { const decimal maxChangeRatio = 0.1m; var ticks = Observable.FromEventPattern\u0026lt;EventHandler\u0026lt;StockTick\u0026gt;, StockTick\u0026gt;( h =\u0026gt; ticker.StockTick += h, h =\u0026gt; ticker.StockTick -= h) .Select(tickEvent =\u0026gt; tickEvent.EventArgs) .Synchronize(); var drasticChanges = from tick in ticks group tick by tick.QuoteSymbol into company from tickPair in company.Buffer(2, 1) let changeRatio = Math.Abs((tickPair[1].Price - tickPair[0].Price)/tickPair[0].Price) where changeRatio \u0026gt; maxChangeRatio select new { Symbol = company.Key, ChangeRatio = changeRatio, OldPrice = tickPair[0].Price, NewPrice = tickPair[1].Price }; _subscription = drasticChanges.Subscribe(change =\u0026gt; { WriteLine($\u0026#34;Stock:{change.Symbol} has changed with {change.ChangeRatio} ratio, Old Price: {change.OldPrice} New Price: {change.NewPrice}\u0026#34;); }, ex =\u0026gt; { /* å¤„ç†é”™è¯¯ */}, () =\u0026gt;{/* å“åº”ä»»åŠ¡å®Œæˆ */}); } public void Dispose() { _subscription.Dispose(); } } Rx çš„ä¼˜ç‚¹ æˆ‘ä»¬å·²ç»ç”¨ä¸¤ç§æ–¹å¼ç¼–å†™äº†è¿™ä¸ªè‚¡ç¥¨ç›‘æ§ç¨‹åºï¼Œæ˜¯æ—¶å€™æ¯”è¾ƒä¸¤ç§å†™æ³•äº†ã€‚\nä»£ç æ›´ç´§å‡‘ï¼šæ‰€æœ‰é€»è¾‘é›†ä¸­åœ¨ä¸€èµ·\næ›´å°‘çš„èµ„æºå ç”¨ï¼šRx å‡ ä¹æ²¡æœ‰èµ„æºå¤„ç†çš„å¼€é”€\nå¼ºå¤§çš„æ“ä½œç¬¦ï¼šRx æœ€æ˜æ˜¾çš„ä¼˜åŠ¿\næ›´ç®€å•åœ°åŒæ­¥ï¼šä¸€ä¸ª Synchronize æ–¹æ³•è¶³çŸ£\n","date":"2022-08-08T00:00:00Z","image":"https://yoroion.github.io/p/rx-magic-2/head_hu60daa3e750dae8efe162b164d024055e_222411_120x120_fill_box_smart1_3.png","permalink":"https://yoroion.github.io/p/rx-magic-2/","title":"Rx.NET å“åº”å¼ç¼–ç¨‹æŒ‡åŒ— 02 - åŸºæœ¬ä½¿ç”¨"},{"content":"å‰è¨€ æœ€è¿‘åˆšè¯»äº† Rx.NET in Actionï¼Œå­¦åˆ°çš„æ–°æ¦‚å¿µéå¸¸å¤šï¼Œæ‹…å¿§è‡ªå·±ä¼šæ—¥æ¸é—å¿˜ï¼Œè§‰å¾—æœ‰å¿…è¦å†™ä¸€ç¯‡åšå®¢è®°å½•ä¸€ä¸‹ï¼Œè¯´ä¸å®šä¹Ÿèƒ½å¸®åˆ°ä¸€äº›å¿—åŒé“åˆçš„æœ‹å‹ã€‚\næœ¬ç³»åˆ—å°†ä¼šä½¿ç”¨æˆ‘æ·±çˆ±çš„ C# è¯­è¨€å’Œ Rx.NET æ¡†æ¶æ¥è®²è§£å“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰çš„é­”æ³• â•°(Â°â–½Â°)â•¯\nèƒŒæ™¯çŸ¥è¯† C# ä¸­çš„å§”æ‰˜ã€æ³›å‹ã€äº‹ä»¶ä»¥åŠ LINQ ç­‰æ¦‚å¿µ Rx = Reactive Extension Rx æ˜¯ç”±å¾®è½¯æ——ä¸‹ä¸€ä¸ªå®éªŒå®¤å‘èµ·çš„ å·¨ç¡¬å¤§æ³•å¥½ å“åº”å¼æ¦‚å¿µ Rx åˆ°åº•æ˜¯å¹²å•¥çš„ï¼Ÿ\né¦–å…ˆæ¥çœ‹çœ‹å¾®è½¯çš„è§£é‡Šï¼šRx = Observables + LINQ + Schedulersã€‚è°”è°”ï¼Œå•¥ç©æ„å„¿ï¼Ÿ\né‚£çœ‹çœ‹å¤§ä½¬æ€ä¹ˆè§£é‡Šçš„å§ï¼šRx = å¤„ç†å¼‚æ­¥æ•°æ®æµã€‚è¿™ä¸ªè§£é‡Šè¿˜è¡Œï¼Œä½†è¿˜æ˜¯ä¸æ˜ç™½ã€‚\nè¿™é‡Œæ˜¯æ›´é€šä¿—çš„è§£é‡Šï¼š\n1 2 3 var a = 1; var b = 2; var c = a + b; // c çš„å€¼æ˜¾ç„¶ä¸º 3 å½“ä½ æ”¹å˜ a æˆ–è€… b å€¼çš„æ—¶å€™ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä»¥å‰çš„æ€ç»´ï¼Œc çš„å€¼å¹¶ä¸ä¼šéšä¹‹å‘ç”Ÿå˜åŒ–ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³è¦ c çš„å€¼éšä¹‹è€Œæ”¹å˜å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå¿«å¿«ä½¿ç”¨ Rxï¼\nå¯è§‚å¯Ÿå¯¹è±¡ Observable 1 2 3 4 public interface IObservable\u0026lt;T\u0026gt; { IDisposable Subscribe(IObserver\u0026lt;T\u0026gt; observer); } æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• Subscribeï¼Œè¿”å› IDisposable å¯¹è±¡ï¼ˆä»£è¡¨ç€è®¢é˜…äº‹ä»¶æœ¬èº«ï¼‰ Observable æŒæœ‰ Observer çš„é›†åˆï¼Œåœ¨å€¼æ”¹å˜æ—¶éšæ—¶é€šçŸ¥å®ƒä»¬ IDisposable å¯¹è±¡å¯ä»¥é€šè¿‡ Dispose æ–¹æ³•éšæ—¶å–æ¶ˆè®¢é˜… è§‚å¯Ÿè€… Observer è§‚å¯Ÿè€…çš„æºç å…¶å®ä¹Ÿå¾ˆç®€å•ã€‚\n1 2 3 4 5 6 public interface IObserver\u0026lt;T\u0026gt; { void OnNext(T value); void OnError(Exception error); void OnCompleted(); } OnNext æ–¹æ³•å®šä¹‰å½“è§‚æµ‹çš„å€¼å‡ºç°å˜åŒ–æ—¶ï¼Œè¯¥åšä»€ä¹ˆï¼ˆç±»æ¯”è¿­ä»£ï¼‰ OnError æ–¹æ³•å®šä¹‰å®ƒå‡ºç°é”™è¯¯æ—¶è¯¥åšä»€ä¹ˆ OnCompleted æ–¹æ³•å®šä¹‰å®ƒä»»åŠ¡å®Œæˆæ—¶è¯¥åšä»€ä¹ˆ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå‘ç”Ÿé”™è¯¯æ—¶ï¼Œæ•°æ®æµå°±ä¼šä¸­æ–­ æ“ä½œç¬¦ Operator Rx å¸¦æ¥äº†æµ·é‡çš„æ“ä½œç¬¦ï¼Œå¸®åŠ©æˆ‘ä»¬åˆ†ç±»ã€æŸ¥æ‰¾ã€è½¬æ¢æ•°æ®ã€‚\nRx.NET çš„æ“ä½œç¬¦ä¸å…¶å®ƒè¯­è¨€çš„ Rx ä¸åŒçš„æ˜¯ï¼Œæ“ä½œç¬¦é‡‡ç”¨äº†åŸæ±åŸå‘³çš„ LINQ é£æ ¼ã€‚\nä¸‹é¢æ¥ç‚¹ç®€å•å®ä¾‹ï¼š\n1 2 3 4 5 6 7 8 IObservable\u0026lt;string\u0026gt; strings= ... // æ•°æ®æº IDisposable subscription = strings // ä¸€ä¸ª IDisposable ä»£è¡¨äº†è®¢é˜…äº‹ä»¶æœ¬èº« .Where(str =\u0026gt; str.StartsWith(\u0026#34;A\u0026#34;)) .Select(str =\u0026gt; str.ToUpper()) .Subscribe(...); // ä¼ å…¥ Observer æˆ–ç›´æ¥ä¼  OnNext æ–¹æ³• subscription.Dispose(); // ä¸Šé¢è¯´è¿‡äº†ï¼Œå¯ä»¥éšæ—¶å–æ¶ˆè®¢é˜… ä¸Šé¢çš„ä»£ç è¯»èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆæµç•…ï¼Ÿ\nå…¶å®ç¬¬ä¸€è¡Œçœç•¥äº†å¦‚ä½•åˆ›å»ºå¯è§‚å¯Ÿæ•°æ®æºï¼Œä¸“æ³¨äºæ“ä½œç¬¦æœ¬èº«ï¼Œè¦ä¸ç„¶å¤ªåŠé€€äº†ã€‚\nå¦‚ä½•åˆ›å»ºå¯è§‚å¯Ÿçš„æ•°æ®æºå°†åœ¨åé¢çš„ç« èŠ‚è®²è§£ã€‚\nç†è§£äº‹ä»¶å’Œæµ Events \u0026amp; Streams äº‹ä»¶éå¸¸å¥½ç†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®å°±æ˜¯ä¸€ä¸ªäº‹ä»¶ã€‚\nåœ¨ C# ä¸­ï¼Œäº‹ä»¶ç”±æ•°æ®æºã€ŒEvent Sourceã€å’Œå¤„ç†å™¨ã€ŒEvent Handlerã€ç»„æˆã€‚\nåœ¨ Rx ä¸­ï¼Œã€ŒEvent Sourceã€å¯¹åº”ã€ŒObservableã€è€Œã€ŒEvent Handlerã€å¯¹åº”ã€ŒObserverã€ã€‚\nä¸‡ç‰©çš†æµ A data stream is like a hose: every drop of water is a data packet that needs to go through stations until it reaches the end. Your data also needs to be filtered and transformed until it gets to the real handler that does something useful with it.\nä¸Šé¢è¿™æ®µ Quote æ¥è‡ª Rx.NET in Actionï¼Œå¤§è‡´çš„æ„æ€å°±æ˜¯æ•°æ®å°±åƒæ°´ç®¡å­ä¸€æ ·ï¼Œæˆ‘ä»¬é€šè¿‡æ“ä½œç¬¦è¿‡æ»¤æ°´æµï¼Œæœ€åé€šè¿‡å–·å¤´å°†æ°´æµä¼ æ’­ã€‚\næˆ‘è®¤ä¸ºè¿™æ˜¯å“åº”å¼çš„æ ¸å¿ƒæ¦‚å¿µã€‚åªè¦ä½ æƒ³æŒç»­åœ°ç›‘å¬æŸæ•°æ®çš„å˜åŒ–ï¼Œé‚£ä¹ˆä½¿ç”¨ Rx è®©æ•°æ®å˜æˆå¯è§‚å¯Ÿæµï¼Œç»å¯¹æ˜¯ä¸ªå¥½ä¸»æ„ã€‚\n","date":"2022-08-07T00:00:00Z","image":"https://yoroion.github.io/p/rx-magic-1/head_hu60daa3e750dae8efe162b164d024055e_222411_120x120_fill_box_smart1_3.png","permalink":"https://yoroion.github.io/p/rx-magic-1/","title":"Rx.NET å“åº”å¼ç¼–ç¨‹æŒ‡åŒ— 01 - åŸºç¡€æ¦‚å¿µ"},{"content":"8 æœˆ 5 æ—¥ åˆæŠ˜è…¾äº†ä¸€ä¸‹åšå®¢ã€‚\næŠŠ Stack ä¸»é¢˜æ¢æˆäº† Taniaï¼Œæ›´å–œæ¬¢è¿™ç§é£æ ¼çš„ã€‚\nTania çš„é…ç½®å‚æ•°ä¹Ÿå¹¶ä¸å¤æ‚ã€‚\nç„¶åå°±æ˜¯éƒ¨ç½²äº† GitHub Actionï¼Œç°åœ¨å†™ä½œç®—æ˜¯æ›´æ–¹ä¾¿äº†ï¼ˆæ‡’\n8 æœˆ 1 æ—¥ ~ 4 æ—¥ å¤©æ°”å¾ˆçƒ­ï¼Œçª—å¤–çš„è‰é¸£è’è€³ã€‚\nå›åŒ—äº¬äº†ã€‚é™ªå®¶äººçœ‹ç”µå½±ã€Šç‹¬è¡Œæœˆçƒã€‹ï¼Œè™½ç„¶åœ¨æ—äººçœ‹æ¥ä¸å…åº¸ä¿—ï¼Œä½†é™ªä¼´å®¶äººä¹Ÿç®—æ˜¯ç¾äº‹ä¸€æ¡©ã€‚\næŠŠ Pikapi åå­—æ”¹å›äº† Picsharp å¹¶æˆåŠŸä¸Šæ¶ NuGetï¼Œè¿™ä¸ªæš‘å‡ç®—æ˜¯æ²¡æœ‰é—æ†¾ã€‚\nå°è¯•å­¦ä¹ å“åº”å¼ç¼–ç¨‹ Rx.NETï¼Œä½†ä¾ç„¶ä¸æ˜¯å¾ˆæ‡‚ï¼ˆæ¼\næœ€è¿‘çš„å¤§äº‹ä»¶ï¼šæ‹­ç›®ä»¥å¾…â†’å®‰å…¨è½åœ°â†’å¼ºçƒˆè°´è´£ï¼ˆç¬‘\næ³¨ï¼šPicsharp = PicACG + C#\n7 æœˆ 31 æ—¥ å½“ä½ è®¤è¯†åˆ°è‡ªå·±ç”Ÿå‘½ä¹‹é‡æ—¶ï¼Œä¾¿æ˜¯è¿ˆå‘äº†å¥¥ä¹‰ä¹‹è·¯ã€‚\nè¿½ã€Šæµªå®¢å‰‘å¿ƒã€‹ã€‚æš‘æœŸçš„è¡¥ä¹ ç»“æŸäº†ï¼Œå¯ä»¥ç¨å¾®æ™šç¡ä¼šå„¿ã€‚\n7 æœˆ 17 æ—¥ ~ 30 æ—¥ è¢«å®¶é•¿æ–­ç½‘ã€‚\nä¸»åŠ›æœºè¢«æ²¡æ”¶äº†ã€‚æŠŠä»¥å‰çš„ Redmi 7 æ‹¿å‡ºæ¥åˆ·ä¸Š LineageOS 19.1 å‡‘åˆç”¨ç€ã€‚\nè¯è¯´ç±»åŸç”Ÿç³»ç»Ÿæ˜¯é’ˆä¸æˆ³ï¼Œæƒ³èµ·æ¥å°å­¦æ—¶ç”¨çš„é‚£éƒ¨åƒåœ¾ Honor 6X ä¹Ÿæ˜¯è¢«æˆ‘ç”¨ LineageOS å¼ºè¡Œç»­å‘½äº†ä¸€å¹´ã€‚\néšæ‰‹å®‰è£…äº†è°·æ­Œç›¸æœºï¼Œä¸ç¦èµå¹ Redmi 7 ä¹Ÿèƒ½æ‹å‡ºè¿™ä¹ˆå¥½çœ‹çš„ç…§ç‰‡ã€‚\nè¿™æ®µæ—¶é—´ä¹Ÿæ²¡æœ‰å‡ºå»ç©ï¼Œæ•…æ— æœ‰è¶£çš„äº‹æƒ…ã€‚\nå†³å®šæ”¾å¼ƒä½¿ç”¨ Kotlin Multiplatform æ¥å†™ Pikapiï¼Œå›å½’ .NETï¼Œé—®å°±æ˜¯ KMP ç”Ÿæ€å¤ªæ¬¡äº†ã€‚\n7 æœˆ 16 æ—¥ æœ‰ç‚¹æ…µæ‡’çš„å‘¨å…­ã€‚\nã€Šå¤–æ˜Ÿä¹Ÿéš¾æ°‘ã€‹ç¬¬ä¸‰å­£æ›´æ–°äº†ã€‚\né˜…è¯» Yabapi çš„æºç ã€‚è¯´å®è¯ï¼Œä½œä¸º API åº“æ¥è¯´å†™å¾—çœŸå¤æ‚ï¼Œä¸è¿‡ B ç«™çš„è§£æå°±æ˜¯è¿™ä¹ˆéš¾ã€‚\nå‘ç°äº†ä¸€ä¸ªä¸‰å¹´å‰çš„å“”å’” API åº“ï¼ˆpicacomic-apiï¼‰ï¼Œä»¥åçš„æ—¥å­å°±æ˜¯åŒæ—¶é˜…è¯»å®ƒçš„æºç å’Œ Yabapi çš„ä»£ç äº†ï¼Œä¼°è®¡æˆ‘èƒ½æ”¹å†™å‡ºä¸ªåŸºäº Kotlin Multiplatform çš„ç‰ˆæœ¬ï¼Ÿ\nåæ§½ä¸€ä¸‹ KMPï¼Œå±…ç„¶è¿ UUID éƒ½æ²¡æœ‰ã€‚å¼•ç”¨ç¬¬ä¸‰æ–¹ç±»åº“çš„æ—¶å€™ï¼ŒGradle ä¸çŸ¥é“æŠ½äº†ä»€ä¹ˆé£ï¼Œæ­»æ´»æ‰¾ä¸åˆ°ä¾èµ–ã€‚ä¸è¿‡ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘çš„é—®é¢˜ï¼ˆå¥½åƒ Version æ ‡æ³¨é”™äº†ï¼‰ï¼Œæ˜å¤©å†ç©ç©å§ã€‚\nC# æ¯æ¬¡ç‰ˆæœ¬æ›´æ–°éƒ½å¤šäº†å¥½å¤šæ–°ç‰¹æ€§ï¼Œä½†æ˜¯å¥½åƒ C# 10 çš„æ–°ç‰¹æ€§æˆ‘éƒ½æ²¡ç”¨ä¸Šå‡ ä¸ªï¼Œæœç„¶ C# å·ç§° GC ç•Œçš„ C++ åä¸è™šä¼ ï¼Œç¨å¾®è½ä¸‹å°±æœ‰ç‚¹å­¦ä¸åŠ¨äº† å‘œå‘œå‘œ\n7 æœˆ 15 æ—¥ å¹³å¸¸çš„å‘¨äº”ï¼Œä½œä¸šã€åˆ·å‰§ï¼ˆRick \u0026amp; Mortyï¼‰ã€è¯»ä¹¦ï¼ˆKickstart Androidï¼‰ã€‚\nå°è±¡æ·±åˆ»çš„æ˜¯å¤ä¹ äº†ä¸€ä¸‹ Jetpack Navigation å’Œ Retrofit çš„ç”¨æ³•ï¼Œå¤ªä¹…æ²¡ç”¨äº†ã€‚\næ–°é¡¹ç›® Pikapi è¿˜æ˜¯æ²¡åŠ¨ï¼Œå› ä¸ºè¿˜åœ¨ç ”ç©¶ Yabapi çš„æºç ã€‚\n","date":"2022-07-15T00:00:00Z","image":"https://yoroion.github.io/p/summer-holiday/linm_hua7d6d9ac0ca43324b0231dc8f11f3450_938203_120x120_fill_box_smart1_3.png","permalink":"https://yoroion.github.io/p/summer-holiday/","title":"äºŒã€‡äºŒäºŒå¹´å¤æ—¥è°ˆ"},{"content":"ä½ å¥½ï¼Œé›¨æœ å¦‚ä½ æ‰€è§ï¼Œè¿™åˆæ˜¯ä¸€ä¸ªä½¿ç”¨ Hugo æ­å»ºçš„åšå®¢ï¼Œä¸»é¢˜æ˜¯ Stack Themeã€‚\næˆ‘æ›¾åœ¨ 2021 å¹´å¤šæ¬¡æ‰“ç®—å¯åŠ¨ä¸€ä¸ªåšå®¢ï¼Œå½“æ—¶æˆ‘è®°å¾—å°è¯•äº†ï¼š\nHexo Jekyll æŸ .NET CMS Hugo å› ä¸ºå½“æ—¶å·²ç»æŠ˜è…¾äº†å¾ˆä¹…ï¼Œçƒ­æƒ…è¢«æ¶ˆç£¨æ®†å°½ï¼Œé€‰æ‹©äº† Hugo å’Œ Eureka Themeï¼Œä½†åé¢å‘ç° Eureka çš„å¾ˆå¤šå°ç»†èŠ‚æˆ‘ä¸æ»¡æ„ï¼Œåˆä¸æƒ³å†èŠ±æ—¶é—´ä¿®æ”¹ Sassï¼ˆçœŸçš„ä½©æœæœ‰äº›å¤§ä½¬ä¸ºäº†è‡ªå®šä¹‰åšå®¢ï¼Œè¯»å®Œäº† Hugo çš„æºç ï¼‰ï¼Œæœ€ç»ˆè‰è‰æ”¾å¼ƒäº†åšå®¢ã€‚\né‡å¯ æ—¶é—´æ¥åˆ°äº† 2022 å¹´ 7 æœˆ 12 æ—¥æš‘å‡ã€‚æ— æ„é—´å‘ç°äº†ä¸€æ¬¾å¾ˆç¬¦åˆæˆ‘å®¡ç¾çš„ä¸»é¢˜ï¼Œä¹Ÿå°±æ˜¯ Stack Themeï¼Œ èŠ±äº†åŠå¤©æ—¶é—´è°ƒè¯•é…ç½®ä¿®æ”¹æ ·å¼å’Œéƒ¨ç½²ã€‚æœ€åï¼Œä¹Ÿå°±é•¿è¿™ä¸ªæ ·å­ã€‚æ„Ÿæ¿€ä¸»é¢˜ä½œè€… Jimmyï¼Œè®©æˆ‘ä¸ç”¨è¿‡å¤šçš„ä¿®æ”¹å°±å¯ä»¥äº«å—åˆ°å¦‚æ­¤å¥½çœ‹çš„ä¸»é¢˜ã€‚\nç»“è¯­ æˆ‘æ€»æ˜¯è®¤ä¸ºï¼Œåšå®¢çš„æ­å»ºé‡å¿ƒåº”è¯¥æ”¾åœ¨å†™ä½œä¸Šï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ä¼šä¸å°å¿ƒæ‰è¿›ã€Œè¿‡åº¦ç¾åŒ–ã€çš„è¯¯åŒºã€‚\næ­¥å…¥é«˜ä¸‰ï¼Œæˆ‘çš„æ—¶é—´è¶Šæ¥è¶Šç´§ä¿ƒã€‚\nä½†æˆ‘ä¼šå°½æˆ‘æ‰€èƒ½ï¼Œè®°å½•æ‰€æ„Ÿæ‰€æ€æ‰€çˆ±ã€‚\nå†™åšå®¢çœŸçš„å¾ˆå¼€å¿ƒå•Š :D\n","date":"2022-07-12T00:00:00Z","image":"https://yoroion.github.io/p/hello-hugo/gg_hue7b940958827379ab0c7c7facdbcc8ef_40036_120x120_fill_q75_box_smart1.jpg","permalink":"https://yoroion.github.io/p/hello-hugo/","title":"åˆä¸€ä¸ªæ— èŠçš„åšå®¢"}]