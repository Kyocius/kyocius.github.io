<!DOCTYPE html>
<html><head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Noto+Serif+SC&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
<title>C# è¿›é˜¶å°å†Œ - å¹¶å‘ä¸å¼‚æ­¥</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="å¤§é‡å‚è€ƒã€ŠC# 10 in a Nutshellã€‹">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="C# è¿›é˜¶å°å†Œ - å¹¶å‘ä¸å¼‚æ­¥" />
<meta property="og:description" content="å¤§é‡å‚è€ƒã€ŠC# 10 in a Nutshellã€‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kyocius.github.io/posts/dotnet/advanced-csharp/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-08-15T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="C# è¿›é˜¶å°å†Œ - å¹¶å‘ä¸å¼‚æ­¥"/>
<meta name="twitter:description" content="å¤§é‡å‚è€ƒã€ŠC# 10 in a Nutshellã€‹"/>









<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "abcdefghzd");
</script>



  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.b60ebb44f6836508f5181ee036582b442efa24bbd7d5e42d547e04e68bd25d01.css" integrity="sha256-tg67RPaDZQj1GB7gNlgrRC76JLvX1eQtVH4E5ovSXQE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    æ­¸æª” Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    åˆ†é¡ Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç°½ Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about/">
                    é—œæ–¼ About
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    è¨‚é–± RSS
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e8%a8%80" class="nav-å‰è¨€">
									å‰è¨€
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b-thread" class="nav-çº¿ç¨‹-thread">
									çº¿ç¨‹ Thread
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b-create-a-thread" class="nav-åˆ›å»ºçº¿ç¨‹-create-a-thread">
									åˆ›å»ºçº¿ç¨‹ Create a Thread
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#join-%e4%b8%8e-sleep" class="nav-join-ä¸-sleep">
									Join ä¸ Sleep
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%98%bb%e5%a1%9e%e7%ba%bf%e7%a8%8b-blocking" class="nav-é˜»å¡çº¿ç¨‹-blocking">
									é˜»å¡çº¿ç¨‹ Blocking
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#io-%e5%af%86%e9%9b%86%e5%9e%8b--%e8%ae%a1%e7%ae%97%e5%af%86%e9%9b%86%e5%9e%8b-bound" class="nav-io-å¯†é›†å‹--è®¡ç®—å¯†é›†å‹-bound">
									I/O å¯†é›†å‹ &amp; è®¡ç®—å¯†é›†å‹ Bound
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f--%e5%85%b1%e4%ba%ab%e7%8a%b6%e6%80%81-local--shared-state" class="nav-å±€éƒ¨å˜é‡--å…±äº«çŠ¶æ€-local--shared-state">
									å±€éƒ¨å˜é‡ &amp; å…±äº«çŠ¶æ€ Local &amp; Shared State
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e9%94%81--%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8-lock--thread-safety" class="nav-çº¿ç¨‹é”--çº¿ç¨‹å®‰å…¨-lock--thread-safety">
									çº¿ç¨‹é” &amp; çº¿ç¨‹å®‰å…¨ Lock &amp; Thread Safety
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%91%e7%ba%bf%e7%a8%8b%e4%bc%a0%e9%80%92%e6%95%b0%e6%8d%ae" class="nav-å‘çº¿ç¨‹ä¼ é€’æ•°æ®">
									å‘çº¿ç¨‹ä¼ é€’æ•°æ®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8d%95%e8%8e%b7%e5%8f%98%e9%87%8f-captured-variables" class="nav-æ•è·å˜é‡-captured-variables">
									æ•è·å˜é‡ Captured Variables
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" class="nav-å¼‚å¸¸å¤„ç†">
									å¼‚å¸¸å¤„ç†
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%9b%86%e4%b8%ad%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86-centralized-exception-handler" class="nav-é›†ä¸­å¼‚å¸¸å¤„ç†-centralized-exception-handler">
									é›†ä¸­å¼‚å¸¸å¤„ç† Centralized Exception Handler
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%89%8d%e5%8f%b0%e7%ba%bf%e7%a8%8b--%e5%90%8e%e5%8f%b0%e7%ba%bf%e7%a8%8b-foreground--background-threads" class="nav-å‰å°çº¿ç¨‹--åå°çº¿ç¨‹-foreground--background-threads">
									å‰å°çº¿ç¨‹ &amp; åå°çº¿ç¨‹ Foreground &amp; Background Threads
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e7%ba%a7%e5%88%ab-thread-priority" class="nav-çº¿ç¨‹çº§åˆ«-thread-priority">
									çº¿ç¨‹çº§åˆ« Thread Priority
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%91%e4%bf%a1%e5%8f%b7-signaling" class="nav-å‘ä¿¡å·-signaling">
									å‘ä¿¡å· Signaling
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e5%9c%a8%e5%ae%a2%e6%88%b7%e7%ab%af%e5%ba%94%e7%94%a8-threading-in-rich-client-applications" class="nav-çº¿ç¨‹åœ¨å®¢æˆ·ç«¯åº”ç”¨-threading-in-rich-client-applications">
									çº¿ç¨‹åœ¨å®¢æˆ·ç«¯åº”ç”¨ Threading in Rich Client Applications
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%8c%e6%ad%a5%e4%b8%8a%e4%b8%8b%e6%96%87-synchronization-contexts" class="nav-åŒæ­¥ä¸Šä¸‹æ–‡-synchronization-contexts">
									åŒæ­¥ä¸Šä¸‹æ–‡ Synchronization Contexts
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0-the-thread-pool" class="nav-çº¿ç¨‹æ± -the-thread-pool">
									çº¿ç¨‹æ±  The Thread Pool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%bf%9b%e5%85%a5%e7%ba%bf%e7%a8%8b%e6%b1%a0-enter-the-pool" class="nav-è¿›å…¥çº¿ç¨‹æ± -enter-the-pool">
									è¿›å…¥çº¿ç¨‹æ±  Enter the pool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e5%8d%ab%e7%94%9f-hygiene-in-the-thread-pool" class="nav-çº¿ç¨‹æ± å«ç”Ÿ-hygiene-in-the-thread-pool">
									çº¿ç¨‹æ± å«ç”Ÿ Hygiene in the thread pool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bb%bb%e5%8a%a1-task" class="nav-ä»»åŠ¡-task">
									ä»»åŠ¡ Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%88%9b%e5%bb%ba%e4%bb%bb%e5%8a%a1-create-a-task" class="nav-åˆ›å»ºä»»åŠ¡-create-a-task">
									åˆ›å»ºä»»åŠ¡ Create a Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%ad%89%e5%be%85-wait" class="nav-ç­‰å¾…-wait">
									ç­‰å¾… Wait
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%80%97%e6%97%b6%e4%bb%bb%e5%8a%a1-longrunning-task" class="nav-è€—æ—¶ä»»åŠ¡-longrunning-task">
									è€—æ—¶ä»»åŠ¡ LongRunning Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%bf%94%e5%9b%9e%e5%80%bc-return-values" class="nav-è¿”å›å€¼-return-values">
									è¿”å›å€¼ Return Values
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%82%e5%b8%b8-exception" class="nav-å¼‚å¸¸-exception">
									å¼‚å¸¸ Exception
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%8e%e7%bb%ad-continuations" class="nav-åç»­-continuations">
									åç»­ Continuations
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#c-%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b" class="nav-c-å¼‚æ­¥ç¼–ç¨‹">
									C# å¼‚æ­¥ç¼–ç¨‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#awaiting" class="nav-awaiting">
									Awaiting
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8d%95%e8%8e%b7%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f-capturing-local-state" class="nav-æ•è·å±€éƒ¨å˜é‡-capturing-local-state">
									æ•è·å±€éƒ¨å˜é‡ Capturing local state
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9c%a8-ui-%e4%b8%ad%e7%ad%89%e5%be%85-awaiting-in-a-ui" class="nav-åœ¨-ui-ä¸­ç­‰å¾…-awaiting-in-a-ui">
									åœ¨ UI ä¸­ç­‰å¾… Awaiting in a UI
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%bc%96%e5%86%99%e5%bc%82%e6%ad%a5%e6%96%b9%e6%b3%95-writing-asynchronous-functions" class="nav-ç¼–å†™å¼‚æ­¥æ–¹æ³•-writing-asynchronous-functions">
									ç¼–å†™å¼‚æ­¥æ–¹æ³• Writing Asynchronous Functions
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%bf%94%e5%9b%9e-tasktresult" class="nav-è¿”å›-tasktresult">
									è¿”å› Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%b9%b6%e8%a1%8c-parallelism" class="nav-å¹¶è¡Œ-parallelism">
									å¹¶è¡Œ Parallelism
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://kyocius.github.io/">
            æ¸¸å°”æ›¼æ–¯å…‹
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://kyocius.github.io/">
        <div class="single-column-header-title">æ¸¸å°”æ›¼æ–¯å…‹</div>
        
        <div class="single-column-header-subtitle">Kyocius &#43;</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    C# è¿›é˜¶å°å†Œ - å¹¶å‘ä¸å¼‚æ­¥
                    
                    <div class="post-subtitle">
                        å¤§é‡å‚è€ƒã€ŠC# 10 in a Nutshellã€‹
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-08-15 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[ç¼–ç¨‹]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/csharp">CSharp</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="å‰è¨€">å‰è¨€</h2>
<p>å°±æ˜¯å¤ªä¹…æ²¡å†™å¼‚æ­¥ï¼Œæœ‰çš„ç”¨æ³•å¿˜äº†ã€‚æ‰€ä»¥å†™ç¯‡åšå®¢å›é¡¾ä¸€ä¸‹ã€‚</p>
<h2 id="çº¿ç¨‹-thread">çº¿ç¨‹ Thread</h2>
<p>è™½ç„¶åœ¨ C# ä¸­ Task çš„ä½¿ç”¨é¢‘ç‡è¿œè¶…ç›´æ¥ä½¿ç”¨çº¿ç¨‹ï¼Œä½†æ˜¯æœ‰å…³çº¿ç¨‹çš„æ¦‚å¿µè¿˜æ˜¯è¦å¤ä¹ ä¸€ä¸‹çš„ã€‚</p>
<p><del>æ‰ä¸æ˜¯å› ä¸ºæˆ‘å…¨å¿˜äº†</del></p>
<h3 id="åˆ›å»ºçº¿ç¨‹-create-a-thread">åˆ›å»ºçº¿ç¨‹ Create a Thread</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Threading;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">var</span> t = <span style="color:#ff79c6">new</span> Thread(WriteY);
</span></span><span style="display:flex;"><span>t.Start();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">var</span> i = <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">1000</span>; i++)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Console.Write(<span style="color:#f1fa8c">&#34;x&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> WriteY()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">var</span> i = <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">1000</span>; i++) Console.Write(<span style="color:#f1fa8c">&#34;y&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//è¾“å‡ºï¼š</span>
</span></span><span style="display:flex;"><span>xxxxxxxxxxxxxyyyyyyyyyyyyyyyyyyyyy...
</span></span><span style="display:flex;"><span>xxxxxxxxxxxxxxxxxxxxxxxxxyyyyyyyyy...
</span></span><span style="display:flex;"><span>xxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyyyy...
</span></span><span style="display:flex;"><span>yyyyyyyyyxxxxxxxxxxxxxxxxxxxxxxxxx...
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Name</code> å±æ€§æ¥è®¿é—®çº¿ç¨‹çš„åå­—ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>WriteLine(Thread.CurrentThread.Name);
</span></span></code></pre></div><h3 id="join-ä¸-sleep">Join ä¸ Sleep</h3>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>Join</code> æ–¹æ³•æ¥ç­‰å¾…çº¿ç¨‹ç»“æŸï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Thread t = <span style="color:#ff79c6">new</span> Thread(Go);
</span></span><span style="display:flex;"><span>t.Start();
</span></span><span style="display:flex;"><span>t.Join();
</span></span><span style="display:flex;"><span>Console.WriteLine(<span style="color:#f1fa8c">&#34;çº¿ç¨‹tç»“æŸ&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> Go() { <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">var</span> i = <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">1000</span>; i++) Console.Write(<span style="color:#f1fa8c">&#34;y&#34;</span>); }
</span></span></code></pre></div><p>è¿™æ®µä»£ç ä¼šæ‰“å° <code>y</code> 1000 æ¬¡ç„¶åæ‰ä¼šè¾“å‡º <code>çº¿ç¨‹tç»“æŸ</code>ã€‚</p>
<p>ä¸‹é¢æ˜¯ <code>Sleep</code> çš„ç”¨æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Thread.Sleep(TimeSpan.FromHours(<span style="color:#bd93f9">1</span>)); <span style="color:#6272a4">//ç¡ä¸€å°æ—¶</span>
</span></span><span style="display:flex;"><span>Thread.Sleep(<span style="color:#bd93f9">500</span>)                    <span style="color:#6272a4">//ç¡500æ¯«ç§’</span>
</span></span></code></pre></div><p>ç‰¹æ®Šçš„æ˜¯ï¼š</p>
<ul>
<li>
<p><code>Thread.Sleep(0)</code> å¯ä»¥æ”¾å¼ƒå½“å‰çº¿ç¨‹ï¼Œä¸»åŠ¨å°† CPU ç§»äº¤ç»™å…¶å®ƒçº¿ç¨‹ã€‚</p>
</li>
<li>
<p><code>Thread.Yield()</code> æ–¹æ³•ä½œç”¨ç±»ä¼¼ï¼Œåªæ˜¯ç§»äº¤<strong>ç›¸åŒçš„</strong>å¤„ç†å™¨ã€‚</p>
</li>
</ul>
<h3 id="é˜»å¡çº¿ç¨‹-blocking">é˜»å¡çº¿ç¨‹ Blocking</h3>
<p>æŸ¥è¯¢é˜»å¡çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> isBlocked = (someThread.ThreadState &amp; ThreadState.WaitSleepJoin) != <span style="color:#bd93f9">0</span>;
</span></span></code></pre></div><blockquote>
<p><code>ThreadState</code> æ˜¯ä¸€ä¸ª flags æšä¸¾ã€‚</p>
</blockquote>
<h4 id="io-å¯†é›†å‹--è®¡ç®—å¯†é›†å‹-bound">I/O å¯†é›†å‹ &amp; è®¡ç®—å¯†é›†å‹ Bound</h4>
<p>ä¸¤è€…æ˜¯ C# å¹¶å‘ä¸­éå¸¸é‡è¦çš„æ¦‚å¿µã€‚</p>
<ul>
<li>ç­‰å¾…äº‹ä»¶å‘ç”Ÿçš„æ“ä½œå«ä½œ <strong>I/O å¯†é›†å‹</strong>ï¼ˆI/O-boundï¼‰</li>
<li>å ç”¨ CPU æ¥å¤„ç†æ•°æ®å«<strong>è®¡ç®—å¯†é›†å‹</strong>ï¼ˆCompute-boundï¼‰</li>
</ul>
<h3 id="å±€éƒ¨å˜é‡--å…±äº«çŠ¶æ€-local--shared-state">å±€éƒ¨å˜é‡ &amp; å…±äº«çŠ¶æ€ Local &amp; Shared State</h3>
<p>CLR ä¼šåˆ†é…ç»™æ¯ä¸ªçº¿ç¨‹ä¸åŒçš„å†…å­˜æ ˆï¼Œæ‰€ä»¥æŸä¸€çº¿ç¨‹çš„å±€éƒ¨å˜é‡æ˜¯ä¸å…¶å®ƒçº¿ç¨‹éš”ç»çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">new</span> Thread (Go).Start(); <span style="color:#6272a4">// åœ¨æ–°çº¿ç¨‹è°ƒç”¨Goæ–¹æ³•</span>
</span></span><span style="display:flex;"><span>Go();                    <span style="color:#6272a4">// åœ¨ä¸»çº¿ç¨‹è°ƒç”¨Goæ–¹æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> Go()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//å±€éƒ¨å˜é‡cycles</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> cycles = <span style="color:#bd93f9">0</span>; cycles &lt; <span style="color:#bd93f9">5</span>; cycles++) Console.Write (<span style="color:#f1fa8c">&#39;?&#39;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œä¼šè¾“å‡º 10 ä¸ªé—®å·ã€Œ?ã€ã€‚</p>
<p>ä½†æ˜¯çº¿ç¨‹å¯ä»¥å…±äº«æ•°æ®ï¼šå¦‚æœå®ƒä»¬æœ‰å¯¹åŒä¸€å¯¹è±¡æˆ–å˜é‡çš„å¼•ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> _done = <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">new</span> Thread (Go).Start();
</span></span><span style="display:flex;"><span>Go()
</span></span><span style="display:flex;"><span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> Go()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (!_done) { _done = <span style="color:#ff79c6">true</span>; Console.WriteLine (<span style="color:#f1fa8c">&#34;Done&#34;</span>); }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä¸¤ä¸ªçº¿ç¨‹å…±äº«äº† <code>_done</code> æ‰€ä»¥ã€ŒDoneã€ä»…ä»…è¾“å‡ºä¸€æ¬¡ã€‚</p>
<p>æ¢æˆ Lambda è¡¨è¾¾å¼ä¹Ÿæ˜¯å¯ä»¥å…±äº«çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> done = <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>ThreadStart action = () =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (!done) { done = <span style="color:#ff79c6">true</span>; Console.WriteLine (<span style="color:#f1fa8c">&#34;Done&#34;</span>); }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">new</span> Thread (action).Start();
</span></span><span style="display:flex;"><span>action();
</span></span></code></pre></div><p>è¿™å¼•å‡ºäº†ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼š<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼</p>
<h3 id="çº¿ç¨‹é”--çº¿ç¨‹å®‰å…¨-lock--thread-safety">çº¿ç¨‹é” &amp; çº¿ç¨‹å®‰å…¨ Lock &amp; Thread Safety</h3>
<p>æ¥çœ‹çœ‹é”ğŸ”’ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">ThreadSafe</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">static</span> <span style="color:#8be9fd">bool</span> _done;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">readonly</span> <span style="color:#8be9fd">object</span> _locker = <span style="color:#ff79c6">new</span> <span style="color:#8be9fd">object</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">void</span> Main()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">new</span> Thread (Go).Start();
</span></span><span style="display:flex;"><span>        Go();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">void</span> Go()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">lock</span> (_locker)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (!_done) { Console.WriteLine (<span style="color:#f1fa8c">&#34;Done&#34;</span>); _done = <span style="color:#ff79c6">true</span>; }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å…¶å®è¿™ä¹Ÿä¸å¿…å¤šè¯´ï¼Œå°±æ˜¯é˜»æ­¢ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹æŸä¸€å˜é‡ç½¢äº†ã€‚</p>
<h3 id="å‘çº¿ç¨‹ä¼ é€’æ•°æ®">å‘çº¿ç¨‹ä¼ é€’æ•°æ®</h3>
<p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åœ¨çº¿ç¨‹å¼€å§‹çš„æ—¶å€™ä¼ é€’æ•°æ®ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Thread t = <span style="color:#ff79c6">new</span> Thread ( () =&gt; Print (<span style="color:#f1fa8c">&#34;Hello from t!&#34;</span>) );
</span></span><span style="display:flex;"><span>t.Start();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> Print (<span style="color:#8be9fd">string</span> message) =&gt; Console.WriteLine (message);
</span></span></code></pre></div><p>ç”¨ Lambda è¡¨è¾¾å¼ä¹Ÿè¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">new</span> Thread (() =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;çœ‹ï¼æˆ‘è·‘åœ¨å¦ä¸€ä¸ªçº¿ç¨‹é‡Œï¼&#34;</span>);
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;æœ‰æ‰‹å°±è¡Œï¼&#34;</span>);
</span></span><span style="display:flex;"><span>}).Start();
</span></span></code></pre></div><h4 id="æ•è·å˜é‡-captured-variables">æ•è·å˜é‡ Captured Variables</h4>
<p>ä¸€å®šè¦å°å¿ƒæ•è·å˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i = <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i++)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">new</span> Thread (() =&gt; Console.Write (i)).Start();
</span></span></code></pre></div><p>è¾“å‡ºç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼ç»“æœï¼š</p>
<pre tabindex="0"><code>0223557799
</code></pre><p>é—®é¢˜æ‰€åœ¨æ˜¯å˜é‡ <code>i</code> æŒ‡å‘äº†å¾ªç¯ä¸­åŒä¸€å†…å­˜ä½ç½®ã€‚æ‰€ä»¥å˜é‡ <code>i</code> çš„å€¼å…¶å®ä¸€ç›´åœ¨è¢«ä¸åŒçº¿ç¨‹ä¿®æ”¹ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i = <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i++)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> temp = i;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">new</span> Thread (() =&gt; Console.Write (temp)).Start();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å†æ¥çœ‹çœ‹ç±»ä¼¼çš„é—®é¢˜ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">string</span> text = <span style="color:#f1fa8c">&#34;t1&#34;</span>;
</span></span><span style="display:flex;"><span>Thread t1 = <span style="color:#ff79c6">new</span> Thread ( () =&gt; Console.WriteLine (text) );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>text = <span style="color:#f1fa8c">&#34;t2&#34;</span>;
</span></span><span style="display:flex;"><span>Thread t2 = <span style="color:#ff79c6">new</span> Thread ( () =&gt; Console.WriteLine (text) 
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>t1.Start(); t2.Start();
</span></span></code></pre></div><p>å› ä¸ºä¸¤ä¸ª Lambda è¡¨è¾¾å¼æ•è·äº†åŒä¸€å˜é‡ <code>text</code>ï¼Œæ‰€ä»¥å€¼ <code>t2</code> ä¼šè¢«è¾“å‡ºä¸¤æ¬¡ã€‚</p>
<h3 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h3>
<p>å…ˆçœ‹çœ‹<strong>ä¸æ­£ç¡®</strong>çš„å†™æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">try</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">new</span> Thread (Go).Start();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">catch</span> (Exception ex)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// æ°¸è¿œä¸ä¼šåˆ°è¾¾è¿™é‡Œï¼</span>
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;Exception!&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> Go() { <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">null</span>; } <span style="color:#6272a4">// æœ¬åº”è¯¥æŠ›å‡ºNullå¼•ç”¨é”™è¯¯</span>
</span></span></code></pre></div><p>æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨çº¿ç¨‹ä¹‹å¤–æ•è·å¼‚å¸¸æ˜¯æ²¡ç”¨çš„ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯æŠŠå¼‚å¸¸å¤„ç†è¯­å¥æ”¾å…¥æ–¹æ³•å†…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">new</span> Thread (Go).Start();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">void</span> Go()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">null</span>; 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">catch</span> (Exception ex)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// è¿™æ ·å°±å¯ä»¥æ•è·äº†</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="é›†ä¸­å¼‚å¸¸å¤„ç†-centralized-exception-handler">é›†ä¸­å¼‚å¸¸å¤„ç† Centralized Exception Handler</h4>
<p>åœ¨ WPFã€UWP æˆ–è€… WinForm åº”ç”¨é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è®¢é˜…<strong>å…¨å±€</strong>å¼‚å¸¸å¤„ç†äº‹ä»¶ <code>Application.DispatcherUnhandledException</code> ä»¥åŠ <code>Application.ThreadException</code>ã€‚</p>
<h3 id="å‰å°çº¿ç¨‹--åå°çº¿ç¨‹-foreground--background-threads">å‰å°çº¿ç¨‹ &amp; åå°çº¿ç¨‹ Foreground &amp; Background Threads</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ æ˜¾å¼åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯å‰å°çº¿ç¨‹ã€‚ç¨‹åºç»“æŸï¼Œä½ çš„æ˜¾å¼çº¿ç¨‹ä¹Ÿä¼šç»“æŸã€‚</p>
<p>åå°çº¿ç¨‹åˆ™ä¸ç„¶ï¼Œä¾ç„¶ä¼šä¿æŒè¿è¡Œã€‚</p>
<p>ä½ å¯ä»¥ç”¨ <code>IsBackground</code> å±æ€§æ¥æ“ä½œå‰åå°çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">static</span> <span style="color:#ff79c6">void</span> Main (<span style="color:#8be9fd">string</span>[] args)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   Thread worker = <span style="color:#ff79c6">new</span> Thread ( () =&gt; Console.ReadLine() );
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">if</span> (args.Length &gt; <span style="color:#bd93f9">0</span>) worker.IsBackground = <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>   worker.Start();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="çº¿ç¨‹çº§åˆ«-thread-priority">çº¿ç¨‹çº§åˆ« Thread Priority</h3>
<p>ä¸€ä¸ªçº¿ç¨‹çš„ <code>Priority</code> å±æ€§å†³å®šäº†å®ƒå¯ä»¥è¿è¡Œå¤šä¹…ï¼ˆç›¸è¾ƒäºå…¶å®ƒçº¿ç¨‹è€Œè¨€ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">enum</span> ThreadPriority { Lowest, BelowNormal, Normal, AboveNormal, Highest }
</span></span></code></pre></div><h3 id="å‘ä¿¡å·-signaling">å‘ä¿¡å· Signaling</h3>
<p>æœ‰æ—¶ï¼Œä½ éœ€è¦çº¿ç¨‹ä¸€ç›´ç­‰å¾…ç›´åˆ°æ”¶åˆ°å…¶å®ƒçº¿ç¨‹å‘é€çš„é€šçŸ¥ï¼Œè¿™å°±æ˜¯ <strong>Signaling</strong>ã€‚</p>
<p>æœ€ç®€å•çš„ Signaling ç»“æ„æ˜¯ <code>ManualResetEvent</code> ã€‚</p>
<p>åœ¨ä¸€ä¸ª <code>ManualResetEvent</code> å—ä¸­è°ƒç”¨ <code>WaitOne</code> æ–¹æ³•ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°å¦ä¸€çº¿ç¨‹è°ƒç”¨ <code>Set</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">var</span> signal = <span style="color:#ff79c6">new</span> ManualResetEvent (<span style="color:#ff79c6">false</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">new</span> Thread (() =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;Waiting for signal...&#34;</span>);
</span></span><span style="display:flex;"><span>    signal.WaitOne();
</span></span><span style="display:flex;"><span>    signal.Dispose();
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;Got signal!&#34;</span>);
</span></span><span style="display:flex;"><span>}).Start();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Thread.Sleep(<span style="color:#bd93f9">2000</span>);
</span></span><span style="display:flex;"><span>signal.Set(); <span style="color:#6272a4">// å‘é€ä¿¡å·</span>
</span></span></code></pre></div><h3 id="çº¿ç¨‹åœ¨å®¢æˆ·ç«¯åº”ç”¨-threading-in-rich-client-applications">çº¿ç¨‹åœ¨å®¢æˆ·ç«¯åº”ç”¨ Threading in Rich Client Applications</h3>
<p>åœ¨ WPF æˆ–è€… UWP ç­‰ç­‰å®¢æˆ·ç«¯çš„å¼€å‘ä¸­ï¼Œä½†æˆ‘ä»¬è¦æ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡æ—¶ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å¯åŠ¨ä¸€ä¸ªã€ŒWorkerã€çº¿ç¨‹ã€‚</p>
<p>å½“ä½ æƒ³è¦ä»ã€ŒWorkerã€çº¿ç¨‹æ›´æ–° UI æ—¶ï¼Œä½ å¿…é¡»ä¼ é€’è‡³ UI çº¿ç¨‹ã€‚ç¼–ç¨‹æœ¯è¯­ã€Œç¼–åˆ— Marshalã€ä¸“é—¨æŒ‡ä»£è¿™ä¸€è¡Œä¸ºã€‚</p>
<ul>
<li>
<p>WPFï¼šè°ƒç”¨ <code>Dispatcher</code> å¯¹è±¡çš„ <code>BeginInvoke</code> æˆ– <code>Invoke</code> æ–¹æ³•</p>
</li>
<li>
<p>UWPï¼šè°ƒç”¨ <code>Dispatcher</code> å¯¹è±¡çš„ <code>RunAsync</code> æˆ– <code>Invoke</code> æ–¹æ³•</p>
</li>
<li>
<p>WinFormï¼šè°ƒç”¨æ§ä»¶çš„ <code>BeginInvoke</code> æˆ– <code>Invoke</code> æ–¹æ³•</p>
</li>
</ul>
<p>è¿™äº›æ–¹æ³•çš„å®è´¨éƒ½æ˜¯æŠŠä½ æƒ³è¦æ‰§è¡Œçš„æ–¹æ³•æ¨é€åˆ° UI çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p>
<p>ä½†æ˜¯ <code>Invoke</code> æ–¹æ³•æœ‰ä¸€ç‚¹ç‰¹æ®Šï¼šå®ƒä¼š<strong>é˜»å¡</strong>çº¿ç¨‹ç›´åˆ°æ¶ˆæ¯è¢« UI çº¿ç¨‹å¤„ç†ã€‚å› æ­¤å®ƒå¯ä»¥ç”¨æ¥è¿”å›å€¼ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">partial</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MyWindow</span> : Window
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">public</span> MyWindow()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        InitializeComponent();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">new</span> Thread (Work).Start();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">void</span> Work()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Thread.Sleep (<span style="color:#bd93f9">5000</span>); <span style="color:#6272a4">// å‡è£…è€—æ—¶ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>        UpdateMessage (<span style="color:#f1fa8c">&#34;The answer&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">void</span> UpdateMessage (<span style="color:#8be9fd">string</span> message)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Action action = () =&gt; txtMessage.Text = message;
</span></span><span style="display:flex;"><span>        Dispatcher.BeginInvoke (action);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="åŒæ­¥ä¸Šä¸‹æ–‡-synchronization-contexts">åŒæ­¥ä¸Šä¸‹æ–‡ Synchronization Contexts</h3>
<p>WPFã€UWP ç­‰ç­‰æ¡†æ¶éƒ½å®ç°äº†è¿™ä¸ªç±»ï¼ˆå­ç±»ï¼‰ã€‚</p>
<p>è¿™ä¸ªç±»è¢«æ”¾åœ¨ <code>System.ComponentModel</code> ä¸­ï¼Œç”¨æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ ã€ŒMarshalã€æ“ä½œã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">partial</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MyWindow</span> : Window
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    SynchronizationContext _uiSyncContext;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">public</span> MyWindow()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        InitializeComponent();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// è·å–å½“å‰UIçº¿ç¨‹çš„åŒæ­¥ä¸Šä¸‹æ–‡</span>
</span></span><span style="display:flex;"><span>        _uiSyncContext = SynchronizationContext.Current;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">new</span> Thread (Work).Start();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">void</span> Work()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Thread.Sleep (<span style="color:#bd93f9">5000</span>); <span style="color:#6272a4">// å‡è£…è€—æ—¶æ“ä½œ</span>
</span></span><span style="display:flex;"><span>        UpdateMessage (<span style="color:#f1fa8c">&#34;The answer&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">void</span> UpdateMessage (<span style="color:#8be9fd">string</span> message)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// Marshalå§”æ‰˜è‡³UIçº¿ç¨‹</span>
</span></span><span style="display:flex;"><span>        _uiSyncContext.Post (_ =&gt; txtMessage.Text = message, <span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è°ƒç”¨ <code>Post</code> æ–¹æ³•ç­‰ä»·äºè°ƒç”¨ <code>BeginInvoke</code> æ–¹æ³•ã€‚</p>
<h3 id="çº¿ç¨‹æ± -the-thread-pool">çº¿ç¨‹æ±  The Thread Pool</h3>
<p>çº¿ç¨‹æ± å°±æ˜¯ç”¨æ¥æ–¹ä¾¿å¤šçº¿ç¨‹ç®¡ç†çš„ã€‚</p>
<p>æœ‰å‡ ç‚¹å€¼å¾—æ³¨æ„ï¼š</p>
<ul>
<li>
<p>ä½ ä¸èƒ½ä¸ºæ± çº¿ç¨‹è®¾ç½® Name å±æ€§ï¼Œè¿™ä¼šè®© Debug æ›´åŠ å›°éš¾</p>
</li>
<li>
<p>æ± çº¿ç¨‹é€šå¸¸æ˜¯<strong>åå°çº¿ç¨‹</strong></p>
</li>
<li>
<p>é˜»å¡æ± çº¿ç¨‹ä¼šå¯¼è‡´æ€§èƒ½é™ä½</p>
</li>
</ul>
<p>ä½ å¯ä»¥æ”¹å˜æ± çº¿ç¨‹çš„çº§åˆ«ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <code>Thread.CurrentThread.IsThreadPoolThread.</code> æ¥æŒ‡å®šæ˜¯å¦è®©çº¿ç¨‹åœ¨æ± é‡Œè¿è¡Œã€‚</p>
<h4 id="è¿›å…¥çº¿ç¨‹æ± -enter-the-pool">è¿›å…¥çº¿ç¨‹æ±  Enter the pool</h4>
<p>æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task.Run (() =&gt; Console.WriteLine (<span style="color:#f1fa8c">&#34;ä½ å…ˆåˆ«æ€¥ï¼ŒTaskåé¢ä¼šè®²&#34;</span>));
</span></span></code></pre></div><p>åœ¨ .NET Framework 4.0 ä»¥å‰çš„ä¸Šå¤æ—¶æœŸ C# æ²¡æœ‰ Task åç¨‹ï¼Œæ˜¯è¿™æ ·è¿›å…¥çº¿ç¨‹æ± çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>ThreadPool.QueueUserWorkItem (notUsed =&gt; Console.WriteLine (<span style="color:#f1fa8c">&#34;Hello&#34;</span>));
</span></span></code></pre></div><blockquote>
<p>éšå¼ä½¿ç”¨çº¿ç¨‹æ± çš„åº“ï¼š</p>
<ul>
<li>
<p>ASP.NET Core / Web API åº”ç”¨</p>
</li>
<li>
<p>System.Timers.Timer å’Œ System.Threading.Timer</p>
</li>
<li>
<p>BackgroundWorker ç±»ï¼ˆä¼ ç»Ÿï¼‰</p>
</li>
</ul>
</blockquote>
<h4 id="çº¿ç¨‹æ± å«ç”Ÿ-hygiene-in-the-thread-pool">çº¿ç¨‹æ± å«ç”Ÿ Hygiene in the thread pool</h4>
<p>çº¿ç¨‹æ± è¿˜æœ‰ä¸€ä¸ªä½œç”¨æ˜¯ä¿è¯ CPU ä¸ä¼šã€Œè¶…é¢è®¤è´­ Oversubscriptionã€ã€‚</p>
<p>ã€ŒOversubscriptionã€æŒ‡çš„æ˜¯æ´»è·ƒçº¿ç¨‹æ•°é‡è¶…è¿‡ CPU æ ¸å¿ƒæ•°é‡çš„çŠ¶æ€ã€‚</p>
<p>æ€»ä¹‹ï¼ŒCLR ä¼šé€šè¿‡æ’åºä»»åŠ¡é˜Ÿåˆ—å’Œå‡é€Ÿä»»åŠ¡å¯åŠ¨æ¥é˜»æ­¢ã€Œè¶…é¢è®¤è´­ã€ã€‚</p>
<hr>
<h2 id="ä»»åŠ¡-task">ä»»åŠ¡ Task</h2>
<h3 id="åˆ›å»ºä»»åŠ¡-create-a-task">åˆ›å»ºä»»åŠ¡ Create a Task</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task.Run (() =&gt; Console.WriteLine (<span style="color:#f1fa8c">&#34;Foo&#34;</span>));
</span></span><span style="display:flex;"><span>Console.ReadLine(); <span style="color:#6272a4">//ç”¨æ¥é˜»å¡ä¸€ä¸‹</span>
</span></span></code></pre></div><h4 id="ç­‰å¾…-wait">ç­‰å¾… Wait</h4>
<p>å’Œçº¿ç¨‹çš„ <code>Join</code> ç±»ä¼¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task task = Task.Run (() =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Thread.Sleep (<span style="color:#bd93f9">2000</span>);
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;Foo&#34;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Console.WriteLine (task.IsCompleted); <span style="color:#6272a4">// False</span>
</span></span><span style="display:flex;"><span>task.Wait(); <span style="color:#6272a4">// é˜»å¡ç›´åˆ°Taskç»“æŸ</span>
</span></span></code></pre></div><h4 id="è€—æ—¶ä»»åŠ¡-longrunning-task">è€—æ—¶ä»»åŠ¡ LongRunning Task</h4>
<p>CLR é»˜è®¤ä¼šè®© Task è¿è¡Œåœ¨æ± çº¿ç¨‹ï¼ˆé€‚ç”¨äºçŸ­æ—¶è®¡ç®—çš„çº¿ç¨‹ï¼‰ã€‚</p>
<p>ä¸ºäº†è¿è¡Œè€—æ—¶é•¿çš„ Taskï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task task = Task.Factory.StartNew (() =&gt; ..., TaskCreationOptions.LongRunning);
</span></span></code></pre></div><h3 id="è¿”å›å€¼-return-values">è¿”å›å€¼ Return Values</h3>
<p>æœ€ç®€å•çš„è¿”å›å€¼å†™æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task&lt;<span style="color:#8be9fd">int</span>&gt; task = Task.Run (() =&gt; { Console.WriteLine (<span style="color:#f1fa8c">&#34;Foo&#34;</span>); <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">3</span>; });
</span></span></code></pre></div><p>ä½ å¯ä»¥é€šè¿‡ Task çš„ <code>Result</code> å±æ€§æ¥è·å–è¿”å›å€¼ã€‚è¿™æ­¥æ“ä½œå°†ä¼šé˜»å¡çº¿ç¨‹ç›´è‡³ Task ç»“æŸï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> result = task.Result;
</span></span><span style="display:flex;"><span>Console.WriteLine(result);
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä½¿ç”¨ LINQ çš„ Taskï¼Œç”¨ä»¥è®¡ç®— 300 0000 ä»¥å†…çš„ç´ æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task&lt;<span style="color:#8be9fd">int</span>&gt; primeNumberTask = Task.Run (() =&gt; 
</span></span><span style="display:flex;"><span>    Enumerable.Range (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3000000</span>).Count (n =&gt;
</span></span><span style="display:flex;"><span>        Enumerable.Range (<span style="color:#bd93f9">2</span>, (<span style="color:#8be9fd">int</span>)Math.Sqrt(n)-<span style="color:#bd93f9">1</span>).All (i =&gt; n % i &gt; <span style="color:#bd93f9">0</span>)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Console.WriteLine (<span style="color:#f1fa8c">&#34;Task running...&#34;</span>);
</span></span><span style="display:flex;"><span>Console.WriteLine (<span style="color:#f1fa8c">&#34;The answer is &#34;</span> + primeNumberTask.Result);
</span></span></code></pre></div><h3 id="å¼‚å¸¸-exception">å¼‚å¸¸ Exception</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#6272a4">//å¼€å¯ä¸€ä¸ªæŠ›å‡ºNullReferenceExceptionçš„Task</span>
</span></span><span style="display:flex;"><span>Task task = Task.Run (() =&gt; { <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">null</span>; });
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">try</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    task.Wait();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">catch</span> (AggregateException aex)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (aex.InnerException <span style="color:#ff79c6">is</span> NullReferenceException)
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;Null!&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">throw</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="åç»­-continuations">åç»­ Continuations</h3>
<p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½“ Task ç»“æŸä¹‹åè¯¥å¹²å•¥ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task&lt;<span style="color:#8be9fd">int</span>&gt; primeNumberTask = Task.Run (() =&gt;
</span></span><span style="display:flex;"><span>    Enumerable.Range (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3000000</span>).Count (n =&gt;
</span></span><span style="display:flex;"><span>        Enumerable.Range (<span style="color:#bd93f9">2</span>, (<span style="color:#8be9fd">int</span>)Math.Sqrt(n)-<span style="color:#bd93f9">1</span>).All (i =&gt; n % i &gt; <span style="color:#bd93f9">0</span>)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">var</span> awaiter = primeNumberTask.GetAwaiter();
</span></span><span style="display:flex;"><span>awaiter.OnCompleted (() =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> result = awaiter.GetResult();
</span></span><span style="display:flex;"><span>    Console.WriteLine (result); 
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><hr>
<h2 id="c-å¼‚æ­¥ç¼–ç¨‹">C# å¼‚æ­¥ç¼–ç¨‹</h2>
<p>ç»ˆäºåˆ°äº†æœ¬ç« çš„é‡å¤´æˆäº†ï¼</p>
<h3 id="awaiting">Awaiting</h3>
<p><code>await</code> å…³é”®å­—è‡ªåŠ¨é™„åŠ åç»­æ“ä½œã€‚</p>
<p>ç®€å•ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">var</span> result = <span style="color:#ff79c6">await</span> expression;
</span></span><span style="display:flex;"><span>statement(s);
</span></span></code></pre></div><p>ç¼–è¯‘å™¨ä¼šæŠŠè¿™å°æ®µä»£ç è‡ªåŠ¨è½¬åŒ–ä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">var</span> awaiter = expression.GetAwaiter();
</span></span><span style="display:flex;"><span>awaiter.OnCompleted (() =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">var</span> result = awaiter.GetResult();
</span></span><span style="display:flex;"><span>    statement(s);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>æ¥çœ‹çœ‹ä¹‹å‰çš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task&lt;<span style="color:#8be9fd">int</span>&gt; GetPrimesCountAsync (<span style="color:#8be9fd">int</span> start, <span style="color:#8be9fd">int</span> count)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Task.Run (() =&gt;
</span></span><span style="display:flex;"><span>        ParallelEnumerable.Range (start, count).Count (n =&gt;
</span></span><span style="display:flex;"><span>            Enumerable.Range (<span style="color:#bd93f9">2</span>, (<span style="color:#8be9fd">int</span>)Math.Sqrt(n)-<span style="color:#bd93f9">1</span>).All (i =&gt; n % i &gt; <span style="color:#bd93f9">0</span>)));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä½¿ç”¨ <code>await</code> å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹è°ƒç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> result = <span style="color:#ff79c6">await</span> GetPrimesCountAsync (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1000000</span>);
</span></span><span style="display:flex;"><span>Console.WriteLine (result);
</span></span></code></pre></div><p>ä½†åœ¨ç¼–è¯‘å‰ï¼Œæˆ‘ä»¬éœ€è¦ç»™å¤–å±‚ä»£ç åŠ ä¸€ä¸ª <code>async</code> å…³é”®å­—ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> <span style="color:#ff79c6">void</span> DisplayPrimesCount()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> result = <span style="color:#ff79c6">await</span> GetPrimesCountAsync (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1000000</span>);
</span></span><span style="display:flex;"><span>    Console.WriteLine (result);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>async</code> å…³é”®å­—åªèƒ½åŠ ç»™è¿”å›å€¼ç±»å‹æ˜¯ <code>void</code>ï¼Œ<code>Task</code> ä»¥åŠ <code>Task&lt;TResult&gt;</code> çš„æ–¹æ³•ã€‚</p>
<p>å½“è¿”å›å€¼æ˜¯ç©ºæ—¶ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">await</span> Task.Delay (<span style="color:#bd93f9">5000</span>);
</span></span><span style="display:flex;"><span>Console.WriteLine (<span style="color:#f1fa8c">&#34;Five seconds passed!&#34;</span>);
</span></span></code></pre></div><h4 id="æ•è·å±€éƒ¨å˜é‡-capturing-local-state">æ•è·å±€éƒ¨å˜é‡ Capturing local state</h4>
<p><code>await</code> çš„çœŸæ­£åŠ›é‡åœ¨äºå®ƒå¯ä»¥å‡ºç°åœ¨ä»£ç çš„ä»»æ„ä½ç½®ï¼ˆä½†ä¸èƒ½åœ¨çº¿ç¨‹é”ä»¥åŠ <code>unsafe</code> å—ä¸­ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> <span style="color:#ff79c6">void</span> DisplayPrimeCounts()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i = <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i++)
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#ff79c6">await</span> GetPrimesCountAsync (i*<span style="color:#bd93f9">1000000</span>+<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1000000</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ <code>GetPrimesCountAsync</code> ä¹‹åï¼Œå˜é‡ <code>i</code> çš„å€¼ä¼šè¢«ä¿å­˜ã€‚</p>
<h4 id="åœ¨-ui-ä¸­ç­‰å¾…-awaiting-in-a-ui">åœ¨ UI ä¸­ç­‰å¾… Awaiting in a UI</h4>
<p>æˆ‘ä»¬å…ˆä»ä¸€ä¸ªåŒæ­¥çš„ä»£ç å¼€å§‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">TestUI</span> : Window
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Button _button = <span style="color:#ff79c6">new</span> Button { Content = <span style="color:#f1fa8c">&#34;Go&#34;</span> };
</span></span><span style="display:flex;"><span>    TextBlock _results = <span style="color:#ff79c6">new</span> TextBlock();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">public</span> TestUI()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">var</span> panel = <span style="color:#ff79c6">new</span> StackPanel();
</span></span><span style="display:flex;"><span>        panel.Children.Add (_button);
</span></span><span style="display:flex;"><span>        panel.Children.Add (_results);
</span></span><span style="display:flex;"><span>        Content = panel;
</span></span><span style="display:flex;"><span>        _button.Click += (sender, args) =&gt; Go();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">void</span> Go()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i = <span style="color:#bd93f9">1</span>; i &lt; <span style="color:#bd93f9">5</span>; i++)
</span></span><span style="display:flex;"><span>        _results.Text += GetPrimesCount (i * <span style="color:#bd93f9">1000000</span>, <span style="color:#bd93f9">1000000</span>) +
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34; primes between &#34;</span> + (i*<span style="color:#bd93f9">1000000</span>) + <span style="color:#f1fa8c">&#34; and &#34;</span> + ((i+<span style="color:#bd93f9">1</span>)*<span style="color:#bd93f9">1000000</span>-<span style="color:#bd93f9">1</span>) +
</span></span><span style="display:flex;"><span>        Environment.NewLine;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> GetPrimesCount (<span style="color:#8be9fd">int</span> start, <span style="color:#8be9fd">int</span> count)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> ParallelEnumerable.Range (start, count).Count (n =&gt; Enumerable.Range (<span style="color:#bd93f9">2</span>, (<span style="color:#8be9fd">int</span>) Math.Sqrt(n)-<span style="color:#bd93f9">1</span>).All (i =&gt; n % i &gt; <span style="color:#bd93f9">0</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ç‚¹å‡»æŒ‰é’®å°±ä¼šé˜»å¡çº¿ç¨‹ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨å¼‚æ­¥æ”¹å†™ã€‚</p>
<p>ç¬¬ä¸€æ­¥æ˜¯æŠŠè®¡ç®—ç´ æ•°çš„æ–¹æ³•æ”¹æˆå¼‚æ­¥çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Task&lt;<span style="color:#8be9fd">int</span>&gt; GetPrimesCountAsync (<span style="color:#8be9fd">int</span> start, <span style="color:#8be9fd">int</span> count)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Task.Run (() =&gt; ParallelEnumerable.Range (start, count).Count(n =&gt; Enumerable.Range(<span style="color:#bd93f9">2</span>, (<span style="color:#8be9fd">int</span>) Math.Sqrt(n)-<span style="color:#bd93f9">1</span>).All (i =&gt; n % i &gt; <span style="color:#bd93f9">0</span>)));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç¬¬äºŒæ­¥æ˜¯ä¿®æ”¹ <code>Go</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> <span style="color:#ff79c6">void</span> Go()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    _button.IsEnabled = <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i = <span style="color:#bd93f9">1</span>; i &lt; <span style="color:#bd93f9">5</span>; i++)
</span></span><span style="display:flex;"><span>    _results.Text += <span style="color:#ff79c6">await</span> GetPrimesCountAsync (i * <span style="color:#bd93f9">1000000</span>, <span style="color:#bd93f9">1000000</span>) + <span style="color:#f1fa8c">&#34; primes between &#34;</span> + (i*<span style="color:#bd93f9">1000000</span>) + <span style="color:#f1fa8c">&#34; and &#34;</span> + ((i+<span style="color:#bd93f9">1</span>)*<span style="color:#bd93f9">1000000</span>-<span style="color:#bd93f9">1</span>) +
</span></span><span style="display:flex;"><span>    Environment.NewLine;
</span></span><span style="display:flex;"><span>    _button.IsEnabled = <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å†æ¥å¦ä¸€ä¸ªä¾‹å­ï¼Œè¿™å›æˆ‘ä»¬æƒ³è¦ä»ç½‘ç»œä¸Šå¼‚æ­¥åœ°ä¸‹è½½æ•°æ®äº†ã€‚</p>
<p>é‡å†™ <code>Go</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> <span style="color:#ff79c6">void</span> Go() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    _button.IsEnabled = <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">string</span>[] urls = <span style="color:#f1fa8c">&#34;yoroion.github.io www.oreilly.com sinoahpx.github.io&#34;</span>.Split();
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> totalLength = <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">foreach</span> (<span style="color:#8be9fd">string</span> url <span style="color:#ff79c6">in</span> urls)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd">var</span> uri = <span style="color:#ff79c6">new</span> Uri(<span style="color:#f1fa8c">&#34;http://&#34;</span> + url)
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd">byte</span>[] data = <span style="color:#ff79c6">await</span> <span style="color:#ff79c6">new</span> WebClient().DownloadDataTaskAsync (uri);
</span></span><span style="display:flex;"><span>            _results.Text += <span style="color:#f1fa8c">&#34;Length of &#34;</span> + url + <span style="color:#f1fa8c">&#34; is &#34;</span> + data.Length + Environment.NewLine;
</span></span><span style="display:flex;"><span>            totalLength += data.Length;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        _results.Text += <span style="color:#f1fa8c">&#34;Total length: &#34;</span> + totalLength;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">catch</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _results.Text += <span style="color:#f1fa8c">&#34;Error: &#34;</span> + ex.Message;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">finally</span> { _button.IsEnabled = <span style="color:#ff79c6">true</span>; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æˆ‘ä»¬é™„åŠ åœ¨ UI æ§ä»¶ä¸Šçš„ Event Handler åœ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmessage loopï¼‰ä¸­è¿›è¡Œã€‚</p>
<p>å½“æˆ‘ä»¬çš„ <code>Go</code> æ–¹æ³•è¿è¡Œæ—¶ï¼Œç›´è‡³é‡åˆ° await è¡¨è¾¾å¼ï¼Œä¼šè·³è½¬å›æ¶ˆæ¯é˜Ÿåˆ—æ¥æ¥å“åº”å…¶å®ƒäº‹ä»¶ã€‚</p>
<h3 id="ç¼–å†™å¼‚æ­¥æ–¹æ³•-writing-asynchronous-functions">ç¼–å†™å¼‚æ­¥æ–¹æ³• Writing Asynchronous Functions</h3>
<p>ç¼–å†™å¼‚æ­¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç©ºè¿”å›å€¼çš„æ–¹æ³•æ”¹æˆè¿”å› Taskï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> Task PrintAnswerToLife() <span style="color:#6272a4">//Task æ›¿ä»£äº† void</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> Task.Delay (<span style="color:#bd93f9">5000</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> answer = <span style="color:#bd93f9">21</span> * <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>    Console.WriteLine (answer);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å¯ä»¥å‘ç°æˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾å¼åœ°è¿”å› Taskï¼Œç¼–è¯‘å™¨å¸®æˆ‘ä»¬ç®€åŒ–äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> Task Go()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> PrintAnswerToLife();
</span></span><span style="display:flex;"><span>    Console.WriteLine(<span style="color:#f1fa8c">&#34;Done&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="è¿”å›-tasktresult">è¿”å› Task<!-- raw HTML omitted --></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> Task&lt;<span style="color:#8be9fd">int</span>&gt; GetAnswerToLife()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> Task.Delay (<span style="color:#bd93f9">5000</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> answer = <span style="color:#bd93f9">21</span> * <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> answer; <span style="color:#6272a4">//ç›´æ¥è¿”å›æ•´å‹</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ•´ä½“çœ‹ä¸€ä¸‹ä»£ç :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">async</span> Task Go()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> PrintAnswerToLife();
</span></span><span style="display:flex;"><span>    Console.WriteLine (<span style="color:#f1fa8c">&#34;Done&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">async</span> Task PrintAnswerToLife()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> answer = <span style="color:#ff79c6">await</span> GetAnswerToLife();
</span></span><span style="display:flex;"><span>    Console.WriteLine (answer);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">async</span> Task&lt;<span style="color:#8be9fd">int</span>&gt; GetAnswerToLife()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">await</span> Task.Delay (<span style="color:#bd93f9">5000</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> answer = <span style="color:#bd93f9">21</span> * <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> answer;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>è¿™ä¹Ÿæ­ç¤ºäº† C# ä¸­ç¼–å†™å¼‚æ­¥æ–¹æ³•çš„åŸºæœ¬åŸåˆ™:</p>
<ol>
<li>å…ˆåŒæ­¥åœ°ç¼–å†™ä»£ç </li>
<li>å°†åŒæ­¥æ–¹æ³•æ”¹æˆå¼‚æ­¥çš„</li>
<li>è¿”å›å€¼æ”¹æˆ Task æˆ– Task<!-- raw HTML omitted --></li>
</ol>
</blockquote>
<h4 id="å¹¶è¡Œ-parallelism">å¹¶è¡Œ Parallelism</h4>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-08-15</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/dotnet/fsharp-for-csharp-devs/">
			ä¸‹å›<br>å†™ç»™ C# å¼€å‘è€…çš„ F# å…‰é€Ÿå…¥é—¨æ•™ç¨‹
                </a>
                
                
                
                <a class="older-posts" href="/posts/dotnet/reactive/rx-magic-3/">
			ä¸Šå›<br>Rx.NET å“åº”å¼ç¼–ç¨‹æŒ‡åŒ— 03 - æ·±å…¥æµçš„åˆ›å»º
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












<script src="https://giscus.app/client.js"
        data-repo="Kyocius/kyocius.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyODE4MDgxOTA="
        data-category="Announcements"
        data-category-id="DIC_kwDOEMwNPs4CXHLA"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://kyocius.github.io/">
    
        <div class="nav-title">
            æ¸¸å°”æ›¼æ–¯å…‹
        </div>
        
        <div class="nav-subtitle">
            Kyocius &#43;
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                æ­¸æª” Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                åˆ†é¡ Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç°½ Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about/">
                é—œæ–¼ About
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                è¨‚é–± RSS
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Kyocius. æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e8%a8%80" class="nav-å‰è¨€">
									å‰è¨€
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b-thread" class="nav-çº¿ç¨‹-thread">
									çº¿ç¨‹ Thread
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b-create-a-thread" class="nav-åˆ›å»ºçº¿ç¨‹-create-a-thread">
									åˆ›å»ºçº¿ç¨‹ Create a Thread
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#join-%e4%b8%8e-sleep" class="nav-join-ä¸-sleep">
									Join ä¸ Sleep
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%98%bb%e5%a1%9e%e7%ba%bf%e7%a8%8b-blocking" class="nav-é˜»å¡çº¿ç¨‹-blocking">
									é˜»å¡çº¿ç¨‹ Blocking
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#io-%e5%af%86%e9%9b%86%e5%9e%8b--%e8%ae%a1%e7%ae%97%e5%af%86%e9%9b%86%e5%9e%8b-bound" class="nav-io-å¯†é›†å‹--è®¡ç®—å¯†é›†å‹-bound">
									I/O å¯†é›†å‹ &amp; è®¡ç®—å¯†é›†å‹ Bound
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f--%e5%85%b1%e4%ba%ab%e7%8a%b6%e6%80%81-local--shared-state" class="nav-å±€éƒ¨å˜é‡--å…±äº«çŠ¶æ€-local--shared-state">
									å±€éƒ¨å˜é‡ &amp; å…±äº«çŠ¶æ€ Local &amp; Shared State
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e9%94%81--%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8-lock--thread-safety" class="nav-çº¿ç¨‹é”--çº¿ç¨‹å®‰å…¨-lock--thread-safety">
									çº¿ç¨‹é” &amp; çº¿ç¨‹å®‰å…¨ Lock &amp; Thread Safety
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%91%e7%ba%bf%e7%a8%8b%e4%bc%a0%e9%80%92%e6%95%b0%e6%8d%ae" class="nav-å‘çº¿ç¨‹ä¼ é€’æ•°æ®">
									å‘çº¿ç¨‹ä¼ é€’æ•°æ®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8d%95%e8%8e%b7%e5%8f%98%e9%87%8f-captured-variables" class="nav-æ•è·å˜é‡-captured-variables">
									æ•è·å˜é‡ Captured Variables
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" class="nav-å¼‚å¸¸å¤„ç†">
									å¼‚å¸¸å¤„ç†
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%9b%86%e4%b8%ad%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86-centralized-exception-handler" class="nav-é›†ä¸­å¼‚å¸¸å¤„ç†-centralized-exception-handler">
									é›†ä¸­å¼‚å¸¸å¤„ç† Centralized Exception Handler
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%89%8d%e5%8f%b0%e7%ba%bf%e7%a8%8b--%e5%90%8e%e5%8f%b0%e7%ba%bf%e7%a8%8b-foreground--background-threads" class="nav-å‰å°çº¿ç¨‹--åå°çº¿ç¨‹-foreground--background-threads">
									å‰å°çº¿ç¨‹ &amp; åå°çº¿ç¨‹ Foreground &amp; Background Threads
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e7%ba%a7%e5%88%ab-thread-priority" class="nav-çº¿ç¨‹çº§åˆ«-thread-priority">
									çº¿ç¨‹çº§åˆ« Thread Priority
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%91%e4%bf%a1%e5%8f%b7-signaling" class="nav-å‘ä¿¡å·-signaling">
									å‘ä¿¡å· Signaling
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e5%9c%a8%e5%ae%a2%e6%88%b7%e7%ab%af%e5%ba%94%e7%94%a8-threading-in-rich-client-applications" class="nav-çº¿ç¨‹åœ¨å®¢æˆ·ç«¯åº”ç”¨-threading-in-rich-client-applications">
									çº¿ç¨‹åœ¨å®¢æˆ·ç«¯åº”ç”¨ Threading in Rich Client Applications
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%8c%e6%ad%a5%e4%b8%8a%e4%b8%8b%e6%96%87-synchronization-contexts" class="nav-åŒæ­¥ä¸Šä¸‹æ–‡-synchronization-contexts">
									åŒæ­¥ä¸Šä¸‹æ–‡ Synchronization Contexts
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0-the-thread-pool" class="nav-çº¿ç¨‹æ± -the-thread-pool">
									çº¿ç¨‹æ±  The Thread Pool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%bf%9b%e5%85%a5%e7%ba%bf%e7%a8%8b%e6%b1%a0-enter-the-pool" class="nav-è¿›å…¥çº¿ç¨‹æ± -enter-the-pool">
									è¿›å…¥çº¿ç¨‹æ±  Enter the pool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e5%8d%ab%e7%94%9f-hygiene-in-the-thread-pool" class="nav-çº¿ç¨‹æ± å«ç”Ÿ-hygiene-in-the-thread-pool">
									çº¿ç¨‹æ± å«ç”Ÿ Hygiene in the thread pool
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bb%bb%e5%8a%a1-task" class="nav-ä»»åŠ¡-task">
									ä»»åŠ¡ Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%88%9b%e5%bb%ba%e4%bb%bb%e5%8a%a1-create-a-task" class="nav-åˆ›å»ºä»»åŠ¡-create-a-task">
									åˆ›å»ºä»»åŠ¡ Create a Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%ad%89%e5%be%85-wait" class="nav-ç­‰å¾…-wait">
									ç­‰å¾… Wait
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%80%97%e6%97%b6%e4%bb%bb%e5%8a%a1-longrunning-task" class="nav-è€—æ—¶ä»»åŠ¡-longrunning-task">
									è€—æ—¶ä»»åŠ¡ LongRunning Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%bf%94%e5%9b%9e%e5%80%bc-return-values" class="nav-è¿”å›å€¼-return-values">
									è¿”å›å€¼ Return Values
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%82%e5%b8%b8-exception" class="nav-å¼‚å¸¸-exception">
									å¼‚å¸¸ Exception
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%8e%e7%bb%ad-continuations" class="nav-åç»­-continuations">
									åç»­ Continuations
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#c-%e5%bc%82%e6%ad%a5%e7%bc%96%e7%a8%8b" class="nav-c-å¼‚æ­¥ç¼–ç¨‹">
									C# å¼‚æ­¥ç¼–ç¨‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#awaiting" class="nav-awaiting">
									Awaiting
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8d%95%e8%8e%b7%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f-capturing-local-state" class="nav-æ•è·å±€éƒ¨å˜é‡-capturing-local-state">
									æ•è·å±€éƒ¨å˜é‡ Capturing local state
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9c%a8-ui-%e4%b8%ad%e7%ad%89%e5%be%85-awaiting-in-a-ui" class="nav-åœ¨-ui-ä¸­ç­‰å¾…-awaiting-in-a-ui">
									åœ¨ UI ä¸­ç­‰å¾… Awaiting in a UI
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%bc%96%e5%86%99%e5%bc%82%e6%ad%a5%e6%96%b9%e6%b3%95-writing-asynchronous-functions" class="nav-ç¼–å†™å¼‚æ­¥æ–¹æ³•-writing-asynchronous-functions">
									ç¼–å†™å¼‚æ­¥æ–¹æ³• Writing Asynchronous Functions
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%bf%94%e5%9b%9e-tasktresult" class="nav-è¿”å›-tasktresult">
									è¿”å› Task
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%b9%b6%e8%a1%8c-parallelism" class="nav-å¹¶è¡Œ-parallelism">
									å¹¶è¡Œ Parallelism
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Kyocius. æœ¬ç«™éµå¾ª CC-BY-NC 4.0 åè®®
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
